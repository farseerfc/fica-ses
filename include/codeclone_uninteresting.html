<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0092)http://tyr.ics.es.osaka-u.ac.jp/project/4f1f68ccb61c5411ac0009dd?cs=4f1f68ccb61c5411ac000a3e -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <script type="text/javascript" src="./codeclone_uninteresting_files/jquery-1.6.2.js"></script>
        <script type="text/javascript" src="./codeclone_uninteresting_files/jquery-ui-1.8.16.custom.min.js"></script>
        <script type="text/javascript" src="./codeclone_uninteresting_files/jquery.scrollintoview.min.js"></script>

        <script type="text/javascript" src="./codeclone_uninteresting_files/bootstrap-scrollspy.js"> </script>
        <script type="text/javascript" src="./codeclone_uninteresting_files/bootstrap-buttons.js"> </script>
        <script type="text/javascript" src="./codeclone_uninteresting_files/bootstrap-modal.js"> </script>
        <script type="text/javascript" src="./codeclone_uninteresting_files/bootstrap-dropdown.js"> </script>
        <script type="text/javascript" src="./codeclone_uninteresting_files/bootstrap-alerts.js"> </script>

        <script type="text/javascript" src="./codeclone_uninteresting_files/sijax.js"></script>

        <script language="javascript" type="text/javascript" src="./codeclone_uninteresting_files/d3.min.js"></script>
        <script language="javascript" type="text/javascript" src="./codeclone_uninteresting_files/chosen.jquery.js"></script>


        <script src="./codeclone_uninteresting_files/d3.layout.min.js" type="text/javascript"> </script>
        <script src="./codeclone_uninteresting_files/d3.geom.min.js" type="text/javascript"> </script>


        <script type="text/javascript" src="./codeclone_uninteresting_files/fica.js"> </script>

        <script type="text/javascript">
            Sijax.setRequestUri("/project/4f1f68ccb61c5411ac0009dd");Sijax.setJsonUri("/static/sijax/json2.js");
        </script>
        <link type="text/css" href="./codeclone_uninteresting_files/jquery-ui-1.8.16.custom.css" rel="stylesheet">	
        <link type="text/css" href="./codeclone_uninteresting_files/bootstrap.css" rel="stylesheet">

        <link href="./codeclone_uninteresting_files/force.css" rel="stylesheet" type="text/css">
        <link href="./codeclone_uninteresting_files/chosen.css" rel="stylesheet" type="text/css">

        
        
<link rel="stylesheet" href="../pygments.css">
<title>Fica -- survey bash-4.2 12-01-25 02:28:20</title>

<script language="javascript">

    var reheight = function(){
        $(".scrollbox").each(function (){
            $(this).css("max-height", $(window).height() -
                $(this).offset().top -
                $(this).attr("data-padding-bottom"));
        });
    }

    var loadCSInternal = function(id){
        $("#codebody").html($("#loading").clone().removeClass("hide"));
        Sijax.request('cloneset', [id]);  
    }

    var loadCloneset = function(id){
        loadCSInternal(id);  
        
        currentUrl = window.location.href;
        baseUrl = currentUrl.replace(/\?.*$/,"");
        newUrl = baseUrl+"?cs="+id
        window.history.pushState({"csid":id},"",newUrl);
    }
    window.onpopstate = function(e){
        if(e.state){
            loadCSInternal(e.state.csid);
            $("#clonesets").accordion("activate","#cs-"+e.state.csid);
        }
    };

    $(document).ready(function () {
        $(window).resize(reheight);
        $("a[name='c0-558']")[0].scrollIntoView();
        $("a[name='c1-221']")[0].scrollIntoView();

        reheight();
    });
</script>

<style type="text/css">

    .fcfcfcccffccfcf{
    }

    .tokenseq{
        overflow: auto;
        max-height: 80px;
        background-color: rgb(240,240,240);
        font-size: x-small;
        width: 100%;
    }

    .scrollbox{
        overflow-y: auto;
        top: 0;
        left: 0;
    }

    .marked{
        color: blue;
    }

    .unmarked{
        color: red;
    }

    .unknown{
        color: black;
    }

    .selected{
        font-style: italic;
        font-weight: bolder;
    }


    .scrollable-sections-top-shadow {
        background-image: -moz-radial-gradient(center top , ellipse farthest-side, rgba(0, 0, 0, 0.3), transparent);
        border-top: 1px solid rgba(0, 0, 0, 0.4);
        top: 0;
        height: 8px;
        left: 0;
        margin-right: 0;
        position: relative;

    }

    .scrollable-sections-bottom-shadow {
        background-image: -moz-radial-gradient(center bottom , ellipse farthest-side, rgba(0, 0, 0, 0.3), transparent);
        border-bottom: 1px solid rgba(0, 0, 0, 0.4);
        bottom: 0;
        height: 8px;
        left: 0;
        margin-right: 0;
        position: relative; 
    }

    .scrollable-holder {
        position: relative;
        float: left; 
    }

    .processbar{
        float: left; 
        height: 1em;
        width: 100%;
        position: relative;
        background-color: white;
        border: 1px solid black; 
    }

    .processbar-value{
        height: 1em;
        position: absolute;
        left: 0;
    }

    .processbar-blue{
        color: #ffffff;
        background-color: #0064cd;
        background-repeat: repeat-x;
        background-image: -khtml-gradient(linear, left top, left bottom, from(#049cdb), to(#0064cd));
        background-image: -moz-linear-gradient(top, #049cdb, #0064cd);
        background-image: -ms-linear-gradient(top, #049cdb, #0064cd);
        background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #049cdb), color-stop(100%, #0064cd));
        background-image: -webkit-linear-gradient(top, #049cdb, #0064cd);
        background-image: -o-linear-gradient(top, #049cdb, #0064cd);
        background-image: linear-gradient(top, #049cdb, #0064cd);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#049cdb', endColorstr='#0064cd', GradientType=0);
        text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25);
        border-color: #0064cd #0064cd #003f81;
        border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25);
    }



    .processbar-red{
        background-color: #c43c35;
        background-repeat: repeat-x;
        background-image: -khtml-gradient(linear, left top, left bottom, from(#ee5f5b), to(#c43c35));
        background-image: -moz-linear-gradient(top, #ee5f5b, #c43c35);
        background-image: -ms-linear-gradient(top, #ee5f5b, #c43c35);
        background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #ee5f5b), color-stop(100%, #c43c35));
        background-image: -webkit-linear-gradient(top, #ee5f5b, #c43c35);
        background-image: -o-linear-gradient(top, #ee5f5b, #c43c35);
        background-image: linear-gradient(top, #ee5f5b, #c43c35);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ee5f5b', endColorstr='#c43c35', GradientType=0);
        text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25);
        border-color: #c43c35 #c43c35 #882a25;
        border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.25);
    }

</style>


    </head>

    <body>

<div id="codebox-container">
        
        <div class="codebox" style="width: 50%; ">
            <h3> lib/readline/terminal.c 
                <small> (556,19)-(568,14)
                </small>
            </h3>
            
            <div class="scrollable-holder">
                <div class="scrollable-sections-top-shadow" style="opacity: 5.5;"></div>
                <div class="scrollbox" data-padding-bottom="20" id="code-scrollbox-0" style="max-height: 752px; ">
                    <div class="highlight"><pre><a name="c0-1"></a><span class="lineno">  1</span> <span class="cm">/* terminal.c -- controlling the terminal with termcap. */</span>
<a name="c0-2"></a><span class="lineno">  2</span> 
<a name="c0-3"></a><span class="lineno">  3</span> <span class="cm">/* Copyright (C) 1996-2009 Free Software Foundation, Inc.</span>
<a name="c0-4"></a><span class="lineno">  4</span> 
<a name="c0-5"></a><span class="lineno">  5</span> <span class="cm">   This file is part of the GNU Readline Library (Readline), a library</span>
<a name="c0-6"></a><span class="lineno">  6</span> <span class="cm">   for reading lines of text with interactive input and history editing.      </span>
<a name="c0-7"></a><span class="lineno">  7</span> 
<a name="c0-8"></a><span class="lineno">  8</span> <span class="cm">   Readline is free software: you can redistribute it and/or modify</span>
<a name="c0-9"></a><span class="lineno">  9</span> <span class="cm">   it under the terms of the GNU General Public License as published by</span>
<a name="c0-10"></a><span class="lineno"> 10</span> <span class="cm">   the Free Software Foundation, either version 3 of the License, or</span>
<a name="c0-11"></a><span class="lineno"> 11</span> <span class="cm">   (at your option) any later version.</span>
<a name="c0-12"></a><span class="lineno"> 12</span> 
<a name="c0-13"></a><span class="lineno"> 13</span> <span class="cm">   Readline is distributed in the hope that it will be useful,</span>
<a name="c0-14"></a><span class="lineno"> 14</span> <span class="cm">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="c0-15"></a><span class="lineno"> 15</span> <span class="cm">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="c0-16"></a><span class="lineno"> 16</span> <span class="cm">   GNU General Public License for more details.</span>
<a name="c0-17"></a><span class="lineno"> 17</span> 
<a name="c0-18"></a><span class="lineno"> 18</span> <span class="cm">   You should have received a copy of the GNU General Public License</span>
<a name="c0-19"></a><span class="lineno"> 19</span> <span class="cm">   along with Readline.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="c0-20"></a><span class="lineno"> 20</span> <span class="cm">*/</span>
<a name="c0-21"></a><span class="lineno"> 21</span> 
<a name="c0-22"></a><span class="lineno"> 22</span> <span class="cp">#define READLINE_LIBRARY</span>
<a name="c0-23"></a><span class="lineno"> 23</span> 
<a name="c0-24"></a><span class="lineno"> 24</span> <span class="cp">#if defined (HAVE_CONFIG_H)</span>
<a name="c0-25"></a><span class="lineno"> 25</span> <span class="cp">#  include &lt;config.h&gt;</span>
<a name="c0-26"></a><span class="lineno"> 26</span> <span class="cp">#endif</span>
<a name="c0-27"></a><span class="lineno"> 27</span> 
<a name="c0-28"></a><span class="lineno"> 28</span> <span class="cp">#include &lt;sys/types.h&gt;</span>
<a name="c0-29"></a><span class="lineno"> 29</span> <span class="cp">#include "posixstat.h"</span>
<a name="c0-30"></a><span class="lineno"> 30</span> <span class="cp">#include &lt;fcntl.h&gt;</span>
<a name="c0-31"></a><span class="lineno"> 31</span> <span class="cp">#if defined (HAVE_SYS_FILE_H)</span>
<a name="c0-32"></a><span class="lineno"> 32</span> <span class="cp">#  include &lt;sys/file.h&gt;</span>
<a name="c0-33"></a><span class="lineno"> 33</span> <span class="cp">#endif </span><span class="cm">/* HAVE_SYS_FILE_H */</span><span class="cp"></span>
<a name="c0-34"></a><span class="lineno"> 34</span> 
<a name="c0-35"></a><span class="lineno"> 35</span> <span class="cp">#if defined (HAVE_UNISTD_H)</span>
<a name="c0-36"></a><span class="lineno"> 36</span> <span class="cp">#  include &lt;unistd.h&gt;</span>
<a name="c0-37"></a><span class="lineno"> 37</span> <span class="cp">#endif </span><span class="cm">/* HAVE_UNISTD_H */</span><span class="cp"></span>
<a name="c0-38"></a><span class="lineno"> 38</span> 
<a name="c0-39"></a><span class="lineno"> 39</span> <span class="cp">#if defined (HAVE_STDLIB_H)</span>
<a name="c0-40"></a><span class="lineno"> 40</span> <span class="cp">#  include &lt;stdlib.h&gt;</span>
<a name="c0-41"></a><span class="lineno"> 41</span> <span class="cp">#else</span>
<a name="c0-42"></a><span class="lineno"> 42</span> <span class="cp">#  include "ansi_stdlib.h"</span>
<a name="c0-43"></a><span class="lineno"> 43</span> <span class="cp">#endif </span><span class="cm">/* HAVE_STDLIB_H */</span><span class="cp"></span>
<a name="c0-44"></a><span class="lineno"> 44</span> 
<a name="c0-45"></a><span class="lineno"> 45</span> <span class="cp">#if defined (HAVE_LOCALE_H)</span>
<a name="c0-46"></a><span class="lineno"> 46</span> <span class="cp">#  include &lt;locale.h&gt;</span>
<a name="c0-47"></a><span class="lineno"> 47</span> <span class="cp">#endif</span>
<a name="c0-48"></a><span class="lineno"> 48</span> 
<a name="c0-49"></a><span class="lineno"> 49</span> <span class="cp">#include &lt;stdio.h&gt;</span>
<a name="c0-50"></a><span class="lineno"> 50</span> 
<a name="c0-51"></a><span class="lineno"> 51</span> <span class="cm">/* System-specific feature definitions and include files. */</span>
<a name="c0-52"></a><span class="lineno"> 52</span> <span class="cp">#include "rldefs.h"</span>
<a name="c0-53"></a><span class="lineno"> 53</span> 
<a name="c0-54"></a><span class="lineno"> 54</span> <span class="cp">#if defined (GWINSZ_IN_SYS_IOCTL) &amp;&amp; !defined (TIOCGWINSZ)</span>
<a name="c0-55"></a><span class="lineno"> 55</span> <span class="cp">#  include &lt;sys/ioctl.h&gt;</span>
<a name="c0-56"></a><span class="lineno"> 56</span> <span class="cp">#endif </span><span class="cm">/* GWINSZ_IN_SYS_IOCTL &amp;&amp; !TIOCGWINSZ */</span><span class="cp"></span>
<a name="c0-57"></a><span class="lineno"> 57</span> 
<a name="c0-58"></a><span class="lineno"> 58</span> <span class="cp">#include "rltty.h"</span>
<a name="c0-59"></a><span class="lineno"> 59</span> <span class="cp">#include "tcap.h"</span>
<a name="c0-60"></a><span class="lineno"> 60</span> 
<a name="c0-61"></a><span class="lineno"> 61</span> <span class="cm">/* Some standard library routines. */</span>
<a name="c0-62"></a><span class="lineno"> 62</span> <span class="cp">#include "readline.h"</span>
<a name="c0-63"></a><span class="lineno"> 63</span> <span class="cp">#include "history.h"</span>
<a name="c0-64"></a><span class="lineno"> 64</span> 
<a name="c0-65"></a><span class="lineno"> 65</span> <span class="cp">#include "rlprivate.h"</span>
<a name="c0-66"></a><span class="lineno"> 66</span> <span class="cp">#include "rlshell.h"</span>
<a name="c0-67"></a><span class="lineno"> 67</span> <span class="cp">#include "xmalloc.h"</span>
<a name="c0-68"></a><span class="lineno"> 68</span> 
<a name="c0-69"></a><span class="lineno"> 69</span> <span class="cp">#if defined (__MINGW32__)</span>
<a name="c0-70"></a><span class="lineno"> 70</span> <span class="cp">#  include &lt;windows.h&gt;</span>
<a name="c0-71"></a><span class="lineno"> 71</span> <span class="cp">#  include &lt;wincon.h&gt;</span>
<a name="c0-72"></a><span class="lineno"> 72</span> 
<a name="c0-73"></a><span class="lineno"> 73</span> <span class="k">static</span> <span class="kt">void</span> <span class="n">_win_get_screensize</span> <span class="n">PARAMS</span><span class="p">((</span><span class="kt">int</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="p">));</span>
<a name="c0-74"></a><span class="lineno"> 74</span> <span class="cp">#endif</span>
<a name="c0-75"></a><span class="lineno"> 75</span> 
<a name="c0-76"></a><span class="lineno"> 76</span> <span class="cp">#if defined (__EMX__)</span>
<a name="c0-77"></a><span class="lineno"> 77</span> <span class="k">static</span> <span class="kt">void</span> <span class="n">_emx_get_screensize</span> <span class="n">PARAMS</span><span class="p">((</span><span class="kt">int</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="p">));</span>
<a name="c0-78"></a><span class="lineno"> 78</span> <span class="cp">#endif</span>
<a name="c0-79"></a><span class="lineno"> 79</span> 
<a name="c0-80"></a><span class="lineno"> 80</span> <span class="cp">#define CUSTOM_REDISPLAY_FUNC() (rl_redisplay_function != rl_redisplay)</span>
<a name="c0-81"></a><span class="lineno"> 81</span> <span class="cp">#define CUSTOM_INPUT_FUNC() (rl_getc_function != rl_getc)</span>
<a name="c0-82"></a><span class="lineno"> 82</span> 
<a name="c0-83"></a><span class="lineno"> 83</span> <span class="cm">/*  If the calling application sets this to a non-zero value, readline will</span>
<a name="c0-84"></a><span class="lineno"> 84</span> <span class="cm">    use the $LINES and $COLUMNS environment variables to set its idea of the</span>
<a name="c0-85"></a><span class="lineno"> 85</span> <span class="cm">    window size before interrogating the kernel. */</span>
<a name="c0-86"></a><span class="lineno"> 86</span> <span class="kt">int</span> <span class="n">rl_prefer_env_winsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="c0-87"></a><span class="lineno"> 87</span> 
<a name="c0-88"></a><span class="lineno"> 88</span> <span class="cm">/* **************************************************************** */</span>
<a name="c0-89"></a><span class="lineno"> 89</span> <span class="cm">/*                   */</span>
<a name="c0-90"></a><span class="lineno"> 90</span> <span class="cm">/*     Terminal and Termcap          */</span>
<a name="c0-91"></a><span class="lineno"> 91</span> <span class="cm">/*                   */</span>
<a name="c0-92"></a><span class="lineno"> 92</span> <span class="cm">/* **************************************************************** */</span>
<a name="c0-93"></a><span class="lineno"> 93</span> 
<a name="c0-94"></a><span class="lineno"> 94</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">term_buffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">;</span>
<a name="c0-95"></a><span class="lineno"> 95</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">term_string_buffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">;</span>
<a name="c0-96"></a><span class="lineno"> 96</span> 
<a name="c0-97"></a><span class="lineno"> 97</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">tcap_initialized</span><span class="p">;</span>
<a name="c0-98"></a><span class="lineno"> 98</span> 
<a name="c0-99"></a><span class="lineno"> 99</span> <span class="cp">#if !defined (__linux__) &amp;&amp; !defined (NCURSES_VERSION)</span>
<a name="c0-100"></a><span class="lineno">100</span> <span class="cp">#  if defined (__EMX__) || defined (NEED_EXTERN_PC)</span>
<a name="c0-101"></a><span class="lineno">101</span> <span class="k">extern</span> 
<a name="c0-102"></a><span class="lineno">102</span> <span class="cp">#  endif </span><span class="cm">/* __EMX__ || NEED_EXTERN_PC */</span><span class="cp"></span>
<a name="c0-103"></a><span class="lineno">103</span> <span class="kt">char</span> <span class="n">PC</span><span class="p">,</span> <span class="o">*</span><span class="n">BC</span><span class="p">,</span> <span class="o">*</span><span class="n">UP</span><span class="p">;</span>
<a name="c0-104"></a><span class="lineno">104</span> <span class="cp">#endif </span><span class="cm">/* !__linux__ &amp;&amp; !NCURSES_VERSION */</span><span class="cp"></span>
<a name="c0-105"></a><span class="lineno">105</span> 
<a name="c0-106"></a><span class="lineno">106</span> <span class="cm">/* Some strings to control terminal actions.  These are output by tputs (). */</span>
<a name="c0-107"></a><span class="lineno">107</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_clreol</span><span class="p">;</span>
<a name="c0-108"></a><span class="lineno">108</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_clrpag</span><span class="p">;</span>
<a name="c0-109"></a><span class="lineno">109</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_cr</span><span class="p">;</span>
<a name="c0-110"></a><span class="lineno">110</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_backspace</span><span class="p">;</span>
<a name="c0-111"></a><span class="lineno">111</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_goto</span><span class="p">;</span>
<a name="c0-112"></a><span class="lineno">112</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_pc</span><span class="p">;</span>
<a name="c0-113"></a><span class="lineno">113</span> 
<a name="c0-114"></a><span class="lineno">114</span> <span class="cm">/* Non-zero if we determine that the terminal can do character insertion. */</span>
<a name="c0-115"></a><span class="lineno">115</span> <span class="kt">int</span> <span class="n">_rl_terminal_can_insert</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="c0-116"></a><span class="lineno">116</span> 
<a name="c0-117"></a><span class="lineno">117</span> <span class="cm">/* How to insert characters. */</span>
<a name="c0-118"></a><span class="lineno">118</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_im</span><span class="p">;</span>
<a name="c0-119"></a><span class="lineno">119</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_ei</span><span class="p">;</span>
<a name="c0-120"></a><span class="lineno">120</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_ic</span><span class="p">;</span>
<a name="c0-121"></a><span class="lineno">121</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_ip</span><span class="p">;</span>
<a name="c0-122"></a><span class="lineno">122</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_IC</span><span class="p">;</span>
<a name="c0-123"></a><span class="lineno">123</span> 
<a name="c0-124"></a><span class="lineno">124</span> <span class="cm">/* How to delete characters. */</span>
<a name="c0-125"></a><span class="lineno">125</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_dc</span><span class="p">;</span>
<a name="c0-126"></a><span class="lineno">126</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_DC</span><span class="p">;</span>
<a name="c0-127"></a><span class="lineno">127</span> 
<a name="c0-128"></a><span class="lineno">128</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_forward_char</span><span class="p">;</span>
<a name="c0-129"></a><span class="lineno">129</span> 
<a name="c0-130"></a><span class="lineno">130</span> <span class="cm">/* How to go up a line. */</span>
<a name="c0-131"></a><span class="lineno">131</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_up</span><span class="p">;</span>
<a name="c0-132"></a><span class="lineno">132</span> 
<a name="c0-133"></a><span class="lineno">133</span> <span class="cm">/* A visible bell; char if the terminal can be made to flash the screen. */</span>
<a name="c0-134"></a><span class="lineno">134</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_visible_bell</span><span class="p">;</span>
<a name="c0-135"></a><span class="lineno">135</span> 
<a name="c0-136"></a><span class="lineno">136</span> <span class="cm">/* Non-zero means the terminal can auto-wrap lines. */</span>
<a name="c0-137"></a><span class="lineno">137</span> <span class="kt">int</span> <span class="n">_rl_term_autowrap</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<a name="c0-138"></a><span class="lineno">138</span> 
<a name="c0-139"></a><span class="lineno">139</span> <span class="cm">/* Non-zero means that this terminal has a meta key. */</span>
<a name="c0-140"></a><span class="lineno">140</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">term_has_meta</span><span class="p">;</span>
<a name="c0-141"></a><span class="lineno">141</span> 
<a name="c0-142"></a><span class="lineno">142</span> <span class="cm">/* The sequences to write to turn on and off the meta key, if this</span>
<a name="c0-143"></a><span class="lineno">143</span> <span class="cm">   terminal has one. */</span>
<a name="c0-144"></a><span class="lineno">144</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_mm</span><span class="p">;</span>
<a name="c0-145"></a><span class="lineno">145</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_mo</span><span class="p">;</span>
<a name="c0-146"></a><span class="lineno">146</span> 
<a name="c0-147"></a><span class="lineno">147</span> <span class="cm">/* The key sequences output by the arrow keys, if this terminal has any. */</span>
<a name="c0-148"></a><span class="lineno">148</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_ku</span><span class="p">;</span>
<a name="c0-149"></a><span class="lineno">149</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_kd</span><span class="p">;</span>
<a name="c0-150"></a><span class="lineno">150</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_kr</span><span class="p">;</span>
<a name="c0-151"></a><span class="lineno">151</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_kl</span><span class="p">;</span>
<a name="c0-152"></a><span class="lineno">152</span> 
<a name="c0-153"></a><span class="lineno">153</span> <span class="cm">/* How to initialize and reset the arrow keys, if this terminal has any. */</span>
<a name="c0-154"></a><span class="lineno">154</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_ks</span><span class="p">;</span>
<a name="c0-155"></a><span class="lineno">155</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_ke</span><span class="p">;</span>
<a name="c0-156"></a><span class="lineno">156</span> 
<a name="c0-157"></a><span class="lineno">157</span> <span class="cm">/* The key sequences sent by the Home and End keys, if any. */</span>
<a name="c0-158"></a><span class="lineno">158</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_kh</span><span class="p">;</span>
<a name="c0-159"></a><span class="lineno">159</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_kH</span><span class="p">;</span>
<a name="c0-160"></a><span class="lineno">160</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_at7</span><span class="p">;</span> <span class="cm">/* @7 */</span>
<a name="c0-161"></a><span class="lineno">161</span> 
<a name="c0-162"></a><span class="lineno">162</span> <span class="cm">/* Delete key */</span>
<a name="c0-163"></a><span class="lineno">163</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_kD</span><span class="p">;</span>
<a name="c0-164"></a><span class="lineno">164</span> 
<a name="c0-165"></a><span class="lineno">165</span> <span class="cm">/* Insert key */</span>
<a name="c0-166"></a><span class="lineno">166</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_kI</span><span class="p">;</span>
<a name="c0-167"></a><span class="lineno">167</span> 
<a name="c0-168"></a><span class="lineno">168</span> <span class="cm">/* Cursor control */</span>
<a name="c0-169"></a><span class="lineno">169</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_vs</span><span class="p">;</span>  <span class="cm">/* very visible */</span>
<a name="c0-170"></a><span class="lineno">170</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_rl_term_ve</span><span class="p">;</span>  <span class="cm">/* normal */</span>
<a name="c0-171"></a><span class="lineno">171</span> 
<a name="c0-172"></a><span class="lineno">172</span> <span class="k">static</span> <span class="kt">void</span> <span class="n">bind_termcap_arrow_keys</span> <span class="n">PARAMS</span><span class="p">((</span><span class="n">Keymap</span><span class="p">));</span>
<a name="c0-173"></a><span class="lineno">173</span> 
<a name="c0-174"></a><span class="lineno">174</span> <span class="cm">/* Variables that hold the screen dimensions, used by the display code. */</span>
<a name="c0-175"></a><span class="lineno">175</span> <span class="kt">int</span> <span class="n">_rl_screenwidth</span><span class="p">,</span> <span class="n">_rl_screenheight</span><span class="p">,</span> <span class="n">_rl_screenchars</span><span class="p">;</span>
<a name="c0-176"></a><span class="lineno">176</span> 
<a name="c0-177"></a><span class="lineno">177</span> <span class="cm">/* Non-zero means the user wants to enable the keypad. */</span>
<a name="c0-178"></a><span class="lineno">178</span> <span class="kt">int</span> <span class="n">_rl_enable_keypad</span><span class="p">;</span>
<a name="c0-179"></a><span class="lineno">179</span> 
<a name="c0-180"></a><span class="lineno">180</span> <span class="cm">/* Non-zero means the user wants to enable a meta key. */</span>
<a name="c0-181"></a><span class="lineno">181</span> <span class="kt">int</span> <span class="n">_rl_enable_meta</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="c0-182"></a><span class="lineno">182</span> 
<a name="c0-183"></a><span class="lineno">183</span> <span class="cp">#if defined (__EMX__)</span>
<a name="c0-184"></a><span class="lineno">184</span> <span class="k">static</span> <span class="kt">void</span>
<a name="c0-185"></a><span class="lineno">185</span> <span class="n">_emx_get_screensize</span> <span class="p">(</span><span class="n">swp</span><span class="p">,</span> <span class="n">shp</span><span class="p">)</span>
<a name="c0-186"></a><span class="lineno">186</span>      <span class="kt">int</span> <span class="o">*</span><span class="n">swp</span><span class="p">,</span> <span class="o">*</span><span class="n">shp</span><span class="p">;</span>
<a name="c0-187"></a><span class="lineno">187</span> <span class="p">{</span>
<a name="c0-188"></a><span class="lineno">188</span>   <span class="kt">int</span> <span class="n">sz</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a name="c0-189"></a><span class="lineno">189</span> 
<a name="c0-190"></a><span class="lineno">190</span>   <span class="n">_scrsize</span> <span class="p">(</span><span class="n">sz</span><span class="p">);</span>
<a name="c0-191"></a><span class="lineno">191</span> 
<a name="c0-192"></a><span class="lineno">192</span>   <span class="k">if</span> <span class="p">(</span><span class="n">swp</span><span class="p">)</span>
<a name="c0-193"></a><span class="lineno">193</span>     <span class="o">*</span><span class="n">swp</span> <span class="o">=</span> <span class="n">sz</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a name="c0-194"></a><span class="lineno">194</span>   <span class="k">if</span> <span class="p">(</span><span class="n">shp</span><span class="p">)</span>
<a name="c0-195"></a><span class="lineno">195</span>     <span class="o">*</span><span class="n">shp</span> <span class="o">=</span> <span class="n">sz</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<a name="c0-196"></a><span class="lineno">196</span> <span class="p">}</span>
<a name="c0-197"></a><span class="lineno">197</span> <span class="cp">#endif</span>
<a name="c0-198"></a><span class="lineno">198</span> 
<a name="c0-199"></a><span class="lineno">199</span> <span class="cp">#if defined (__MINGW32__)</span>
<a name="c0-200"></a><span class="lineno">200</span> <span class="k">static</span> <span class="kt">void</span>
<a name="c0-201"></a><span class="lineno">201</span> <span class="n">_win_get_screensize</span> <span class="p">(</span><span class="n">swp</span><span class="p">,</span> <span class="n">shp</span><span class="p">)</span>
<a name="c0-202"></a><span class="lineno">202</span>      <span class="kt">int</span> <span class="o">*</span><span class="n">swp</span><span class="p">,</span> <span class="o">*</span><span class="n">shp</span><span class="p">;</span>
<a name="c0-203"></a><span class="lineno">203</span> <span class="p">{</span>
<a name="c0-204"></a><span class="lineno">204</span>   <span class="n">HANDLE</span> <span class="n">hConOut</span><span class="p">;</span>
<a name="c0-205"></a><span class="lineno">205</span>   <span class="n">CONSOLE_SCREEN_BUFFER_INFO</span> <span class="n">scr</span><span class="p">;</span>
<a name="c0-206"></a><span class="lineno">206</span> 
<a name="c0-207"></a><span class="lineno">207</span>   <span class="n">hConOut</span> <span class="o">=</span> <span class="n">GetStdHandle</span> <span class="p">(</span><span class="n">STD_OUTPUT_HANDLE</span><span class="p">);</span>
<a name="c0-208"></a><span class="lineno">208</span>   <span class="k">if</span> <span class="p">(</span><span class="n">hConOut</span> <span class="o">!=</span> <span class="n">INVALID_HANDLE_VALUE</span><span class="p">)</span>
<a name="c0-209"></a><span class="lineno">209</span>     <span class="p">{</span>
<a name="c0-210"></a><span class="lineno">210</span>       <span class="k">if</span> <span class="p">(</span><span class="n">GetConsoleScreenBufferInfo</span> <span class="p">(</span><span class="n">hConOut</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">scr</span><span class="p">))</span>
<a name="c0-211"></a><span class="lineno">211</span>  <span class="p">{</span>
<a name="c0-212"></a><span class="lineno">212</span>    <span class="o">*</span><span class="n">swp</span> <span class="o">=</span> <span class="n">scr</span><span class="p">.</span><span class="n">dwSize</span><span class="p">.</span><span class="n">X</span><span class="p">;</span>
<a name="c0-213"></a><span class="lineno">213</span>    <span class="o">*</span><span class="n">shp</span> <span class="o">=</span> <span class="n">scr</span><span class="p">.</span><span class="n">srWindow</span><span class="p">.</span><span class="n">Bottom</span> <span class="o">-</span> <span class="n">scr</span><span class="p">.</span><span class="n">srWindow</span><span class="p">.</span><span class="n">Top</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<a name="c0-214"></a><span class="lineno">214</span>  <span class="p">}</span>
<a name="c0-215"></a><span class="lineno">215</span>     <span class="p">}</span>
<a name="c0-216"></a><span class="lineno">216</span> <span class="p">}</span>
<a name="c0-217"></a><span class="lineno">217</span> <span class="cp">#endif</span>
<a name="c0-218"></a><span class="lineno">218</span> 
<a name="c0-219"></a><span class="lineno">219</span> <span class="cm">/* Get readline's idea of the screen size.  TTY is a file descriptor open</span>
<a name="c0-220"></a><span class="lineno">220</span> <span class="cm">   to the terminal.  If IGNORE_ENV is true, we do not pay attention to the</span>
<a name="c0-221"></a><span class="lineno">221</span> <span class="cm">   values of $LINES and $COLUMNS.  The tests for TERM_STRING_BUFFER being</span>
<a name="c0-222"></a><span class="lineno">222</span> <span class="cm">   non-null serve to check whether or not we have initialized termcap. */</span>
<a name="c0-223"></a><span class="lineno">223</span> <span class="kt">void</span>
<a name="c0-224"></a><span class="lineno">224</span> <span class="n">_rl_get_screen_size</span> <span class="p">(</span><span class="n">tty</span><span class="p">,</span> <span class="n">ignore_env</span><span class="p">)</span>
<a name="c0-225"></a><span class="lineno">225</span>      <span class="kt">int</span> <span class="n">tty</span><span class="p">,</span> <span class="n">ignore_env</span><span class="p">;</span>
<a name="c0-226"></a><span class="lineno">226</span> <span class="p">{</span>
<a name="c0-227"></a><span class="lineno">227</span>   <span class="kt">char</span> <span class="o">*</span><span class="n">ss</span><span class="p">;</span>
<a name="c0-228"></a><span class="lineno">228</span> <span class="cp">#if defined (TIOCGWINSZ)</span>
<a name="c0-229"></a><span class="lineno">229</span>   <span class="k">struct</span> <span class="n">winsize</span> <span class="n">window_size</span><span class="p">;</span>
<a name="c0-230"></a><span class="lineno">230</span> <span class="cp">#endif </span><span class="cm">/* TIOCGWINSZ */</span><span class="cp"></span>
<a name="c0-231"></a><span class="lineno">231</span>   <span class="kt">int</span> <span class="n">wr</span><span class="p">,</span> <span class="n">wc</span><span class="p">;</span>
<a name="c0-232"></a><span class="lineno">232</span> 
<a name="c0-233"></a><span class="lineno">233</span>   <span class="n">wr</span> <span class="o">=</span> <span class="n">wc</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<a name="c0-234"></a><span class="lineno">234</span> <span class="cp">#if defined (TIOCGWINSZ)</span>
<a name="c0-235"></a><span class="lineno">235</span>   <span class="k">if</span> <span class="p">(</span><span class="n">ioctl</span> <span class="p">(</span><span class="n">tty</span><span class="p">,</span> <span class="n">TIOCGWINSZ</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">window_size</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-236"></a><span class="lineno">236</span>     <span class="p">{</span>
<a name="c0-237"></a><span class="lineno">237</span>       <span class="n">wc</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">window_size</span><span class="p">.</span><span class="n">ws_col</span><span class="p">;</span>
<a name="c0-238"></a><span class="lineno">238</span>       <span class="n">wr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">window_size</span><span class="p">.</span><span class="n">ws_row</span><span class="p">;</span>
<a name="c0-239"></a><span class="lineno">239</span>     <span class="p">}</span>
<a name="c0-240"></a><span class="lineno">240</span> <span class="cp">#endif </span><span class="cm">/* TIOCGWINSZ */</span><span class="cp"></span>
<a name="c0-241"></a><span class="lineno">241</span> 
<a name="c0-242"></a><span class="lineno">242</span> <span class="cp">#if defined (__EMX__)</span>
<a name="c0-243"></a><span class="lineno">243</span>   <span class="n">_emx_get_screensize</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">wc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wr</span><span class="p">);</span>
<a name="c0-244"></a><span class="lineno">244</span> <span class="cp">#elif defined (__MINGW32__)</span>
<a name="c0-245"></a><span class="lineno">245</span>   <span class="n">_win_get_screensize</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">wc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wr</span><span class="p">);</span>
<a name="c0-246"></a><span class="lineno">246</span> <span class="cp">#endif</span>
<a name="c0-247"></a><span class="lineno">247</span> 
<a name="c0-248"></a><span class="lineno">248</span>   <span class="k">if</span> <span class="p">(</span><span class="n">ignore_env</span> <span class="o">||</span> <span class="n">rl_prefer_env_winsize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-249"></a><span class="lineno">249</span>     <span class="p">{</span>
<a name="c0-250"></a><span class="lineno">250</span>       <span class="n">_rl_screenwidth</span> <span class="o">=</span> <span class="n">wc</span><span class="p">;</span>
<a name="c0-251"></a><span class="lineno">251</span>       <span class="n">_rl_screenheight</span> <span class="o">=</span> <span class="n">wr</span><span class="p">;</span>
<a name="c0-252"></a><span class="lineno">252</span>     <span class="p">}</span>
<a name="c0-253"></a><span class="lineno">253</span>   <span class="k">else</span>
<a name="c0-254"></a><span class="lineno">254</span>     <span class="n">_rl_screenwidth</span> <span class="o">=</span> <span class="n">_rl_screenheight</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<a name="c0-255"></a><span class="lineno">255</span> 
<a name="c0-256"></a><span class="lineno">256</span>   <span class="cm">/* Environment variable COLUMNS overrides setting of "co" if IGNORE_ENV</span>
<a name="c0-257"></a><span class="lineno">257</span> <span class="cm">     is unset.  If we prefer the environment, check it first before</span>
<a name="c0-258"></a><span class="lineno">258</span> <span class="cm">     assigning the value returned by the kernel. */</span>
<a name="c0-259"></a><span class="lineno">259</span>   <span class="k">if</span> <span class="p">(</span><span class="n">_rl_screenwidth</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-260"></a><span class="lineno">260</span>     <span class="p">{</span>
<a name="c0-261"></a><span class="lineno">261</span>       <span class="k">if</span> <span class="p">(</span><span class="n">ignore_env</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ss</span> <span class="o">=</span> <span class="n">sh_get_env_value</span> <span class="p">(</span><span class="s">"COLUMNS"</span><span class="p">)))</span>
<a name="c0-262"></a><span class="lineno">262</span>  <span class="n">_rl_screenwidth</span> <span class="o">=</span> <span class="n">atoi</span> <span class="p">(</span><span class="n">ss</span><span class="p">);</span>
<a name="c0-263"></a><span class="lineno">263</span> 
<a name="c0-264"></a><span class="lineno">264</span>       <span class="k">if</span> <span class="p">(</span><span class="n">_rl_screenwidth</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-265"></a><span class="lineno">265</span>         <span class="n">_rl_screenwidth</span> <span class="o">=</span> <span class="n">wc</span><span class="p">;</span>
<a name="c0-266"></a><span class="lineno">266</span> 
<a name="c0-267"></a><span class="lineno">267</span> <span class="cp">#if !defined (__DJGPP__)</span>
<a name="c0-268"></a><span class="lineno">268</span>       <span class="k">if</span> <span class="p">(</span><span class="n">_rl_screenwidth</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">term_string_buffer</span><span class="p">)</span>
<a name="c0-269"></a><span class="lineno">269</span>  <span class="n">_rl_screenwidth</span> <span class="o">=</span> <span class="n">tgetnum</span> <span class="p">(</span><span class="s">"co"</span><span class="p">);</span>
<a name="c0-270"></a><span class="lineno">270</span> <span class="cp">#endif</span>
<a name="c0-271"></a><span class="lineno">271</span>     <span class="p">}</span>
<a name="c0-272"></a><span class="lineno">272</span> 
<a name="c0-273"></a><span class="lineno">273</span>   <span class="cm">/* Environment variable LINES overrides setting of "li" if IGNORE_ENV</span>
<a name="c0-274"></a><span class="lineno">274</span> <span class="cm">     is unset. */</span>
<a name="c0-275"></a><span class="lineno">275</span>   <span class="k">if</span> <span class="p">(</span><span class="n">_rl_screenheight</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-276"></a><span class="lineno">276</span>     <span class="p">{</span>
<a name="c0-277"></a><span class="lineno">277</span>       <span class="k">if</span> <span class="p">(</span><span class="n">ignore_env</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ss</span> <span class="o">=</span> <span class="n">sh_get_env_value</span> <span class="p">(</span><span class="s">"LINES"</span><span class="p">)))</span>
<a name="c0-278"></a><span class="lineno">278</span>  <span class="n">_rl_screenheight</span> <span class="o">=</span> <span class="n">atoi</span> <span class="p">(</span><span class="n">ss</span><span class="p">);</span>
<a name="c0-279"></a><span class="lineno">279</span> 
<a name="c0-280"></a><span class="lineno">280</span>       <span class="k">if</span> <span class="p">(</span><span class="n">_rl_screenheight</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-281"></a><span class="lineno">281</span>         <span class="n">_rl_screenheight</span> <span class="o">=</span> <span class="n">wr</span><span class="p">;</span>
<a name="c0-282"></a><span class="lineno">282</span> 
<a name="c0-283"></a><span class="lineno">283</span> <span class="cp">#if !defined (__DJGPP__)</span>
<a name="c0-284"></a><span class="lineno">284</span>       <span class="k">if</span> <span class="p">(</span><span class="n">_rl_screenheight</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">term_string_buffer</span><span class="p">)</span>
<a name="c0-285"></a><span class="lineno">285</span>  <span class="n">_rl_screenheight</span> <span class="o">=</span> <span class="n">tgetnum</span> <span class="p">(</span><span class="s">"li"</span><span class="p">);</span>
<a name="c0-286"></a><span class="lineno">286</span> <span class="cp">#endif</span>
<a name="c0-287"></a><span class="lineno">287</span>     <span class="p">}</span>
<a name="c0-288"></a><span class="lineno">288</span> 
<a name="c0-289"></a><span class="lineno">289</span>   <span class="cm">/* If all else fails, default to 80x24 terminal. */</span>
<a name="c0-290"></a><span class="lineno">290</span>   <span class="k">if</span> <span class="p">(</span><span class="n">_rl_screenwidth</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
<a name="c0-291"></a><span class="lineno">291</span>     <span class="n">_rl_screenwidth</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
<a name="c0-292"></a><span class="lineno">292</span> 
<a name="c0-293"></a><span class="lineno">293</span>   <span class="k">if</span> <span class="p">(</span><span class="n">_rl_screenheight</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-294"></a><span class="lineno">294</span>     <span class="n">_rl_screenheight</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span>
<a name="c0-295"></a><span class="lineno">295</span> 
<a name="c0-296"></a><span class="lineno">296</span>   <span class="cm">/* If we're being compiled as part of bash, set the environment</span>
<a name="c0-297"></a><span class="lineno">297</span> <span class="cm">     variables $LINES and $COLUMNS to new values.  Otherwise, just</span>
<a name="c0-298"></a><span class="lineno">298</span> <span class="cm">     do a pair of putenv () or setenv () calls. */</span>
<a name="c0-299"></a><span class="lineno">299</span>   <span class="n">sh_set_lines_and_columns</span> <span class="p">(</span><span class="n">_rl_screenheight</span><span class="p">,</span> <span class="n">_rl_screenwidth</span><span class="p">);</span>
<a name="c0-300"></a><span class="lineno">300</span> 
<a name="c0-301"></a><span class="lineno">301</span>   <span class="k">if</span> <span class="p">(</span><span class="n">_rl_term_autowrap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-302"></a><span class="lineno">302</span>     <span class="n">_rl_screenwidth</span><span class="o">--</span><span class="p">;</span>
<a name="c0-303"></a><span class="lineno">303</span> 
<a name="c0-304"></a><span class="lineno">304</span>   <span class="n">_rl_screenchars</span> <span class="o">=</span> <span class="n">_rl_screenwidth</span> <span class="o">*</span> <span class="n">_rl_screenheight</span><span class="p">;</span>
<a name="c0-305"></a><span class="lineno">305</span> <span class="p">}</span>
<a name="c0-306"></a><span class="lineno">306</span> 
<a name="c0-307"></a><span class="lineno">307</span> <span class="kt">void</span>
<a name="c0-308"></a><span class="lineno">308</span> <span class="n">_rl_set_screen_size</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
<a name="c0-309"></a><span class="lineno">309</span>      <span class="kt">int</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">;</span>
<a name="c0-310"></a><span class="lineno">310</span> <span class="p">{</span>
<a name="c0-311"></a><span class="lineno">311</span>   <span class="k">if</span> <span class="p">(</span><span class="n">_rl_term_autowrap</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="c0-312"></a><span class="lineno">312</span>     <span class="n">_rl_init_terminal_io</span> <span class="p">(</span><span class="n">rl_terminal_name</span><span class="p">);</span>
<a name="c0-313"></a><span class="lineno">313</span> 
<a name="c0-314"></a><span class="lineno">314</span>   <span class="k">if</span> <span class="p">(</span><span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-315"></a><span class="lineno">315</span>     <span class="n">_rl_screenheight</span> <span class="o">=</span> <span class="n">rows</span><span class="p">;</span>
<a name="c0-316"></a><span class="lineno">316</span>   <span class="k">if</span> <span class="p">(</span><span class="n">cols</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-317"></a><span class="lineno">317</span>     <span class="p">{</span>
<a name="c0-318"></a><span class="lineno">318</span>       <span class="n">_rl_screenwidth</span> <span class="o">=</span> <span class="n">cols</span><span class="p">;</span>
<a name="c0-319"></a><span class="lineno">319</span>       <span class="k">if</span> <span class="p">(</span><span class="n">_rl_term_autowrap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-320"></a><span class="lineno">320</span>  <span class="n">_rl_screenwidth</span><span class="o">--</span><span class="p">;</span>
<a name="c0-321"></a><span class="lineno">321</span>     <span class="p">}</span>
<a name="c0-322"></a><span class="lineno">322</span> 
<a name="c0-323"></a><span class="lineno">323</span>   <span class="k">if</span> <span class="p">(</span><span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">cols</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-324"></a><span class="lineno">324</span>     <span class="n">_rl_screenchars</span> <span class="o">=</span> <span class="n">_rl_screenwidth</span> <span class="o">*</span> <span class="n">_rl_screenheight</span><span class="p">;</span>
<a name="c0-325"></a><span class="lineno">325</span> <span class="p">}</span>
<a name="c0-326"></a><span class="lineno">326</span> 
<a name="c0-327"></a><span class="lineno">327</span> <span class="kt">void</span>
<a name="c0-328"></a><span class="lineno">328</span> <span class="n">rl_set_screen_size</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
<a name="c0-329"></a><span class="lineno">329</span>      <span class="kt">int</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">;</span>
<a name="c0-330"></a><span class="lineno">330</span> <span class="p">{</span>
<a name="c0-331"></a><span class="lineno">331</span>   <span class="n">_rl_set_screen_size</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">);</span>
<a name="c0-332"></a><span class="lineno">332</span> <span class="p">}</span>
<a name="c0-333"></a><span class="lineno">333</span> 
<a name="c0-334"></a><span class="lineno">334</span> <span class="kt">void</span>
<a name="c0-335"></a><span class="lineno">335</span> <span class="n">rl_get_screen_size</span> <span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
<a name="c0-336"></a><span class="lineno">336</span>      <span class="kt">int</span> <span class="o">*</span><span class="n">rows</span><span class="p">,</span> <span class="o">*</span><span class="n">cols</span><span class="p">;</span>
<a name="c0-337"></a><span class="lineno">337</span> <span class="p">{</span>
<a name="c0-338"></a><span class="lineno">338</span>   <span class="k">if</span> <span class="p">(</span><span class="n">rows</span><span class="p">)</span>
<a name="c0-339"></a><span class="lineno">339</span>     <span class="o">*</span><span class="n">rows</span> <span class="o">=</span> <span class="n">_rl_screenheight</span><span class="p">;</span>
<a name="c0-340"></a><span class="lineno">340</span>   <span class="k">if</span> <span class="p">(</span><span class="n">cols</span><span class="p">)</span>
<a name="c0-341"></a><span class="lineno">341</span>     <span class="o">*</span><span class="n">cols</span> <span class="o">=</span> <span class="n">_rl_screenwidth</span><span class="p">;</span>
<a name="c0-342"></a><span class="lineno">342</span> <span class="p">}</span>
<a name="c0-343"></a><span class="lineno">343</span> 
<a name="c0-344"></a><span class="lineno">344</span> <span class="kt">void</span>
<a name="c0-345"></a><span class="lineno">345</span> <span class="n">rl_reset_screen_size</span> <span class="p">()</span>
<a name="c0-346"></a><span class="lineno">346</span> <span class="p">{</span>
<a name="c0-347"></a><span class="lineno">347</span>   <span class="n">_rl_get_screen_size</span> <span class="p">(</span><span class="n">fileno</span> <span class="p">(</span><span class="n">rl_instream</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<a name="c0-348"></a><span class="lineno">348</span> <span class="p">}</span>
<a name="c0-349"></a><span class="lineno">349</span>      
<a name="c0-350"></a><span class="lineno">350</span> <span class="kt">void</span>
<a name="c0-351"></a><span class="lineno">351</span> <span class="n">rl_resize_terminal</span> <span class="p">()</span>
<a name="c0-352"></a><span class="lineno">352</span> <span class="p">{</span>
<a name="c0-353"></a><span class="lineno">353</span>   <span class="n">_rl_get_screen_size</span> <span class="p">(</span><span class="n">fileno</span> <span class="p">(</span><span class="n">rl_instream</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
<a name="c0-354"></a><span class="lineno">354</span>   <span class="k">if</span> <span class="p">(</span><span class="n">_rl_echoing_p</span><span class="p">)</span>
<a name="c0-355"></a><span class="lineno">355</span>     <span class="p">{</span>
<a name="c0-356"></a><span class="lineno">356</span>       <span class="k">if</span> <span class="p">(</span><span class="n">CUSTOM_REDISPLAY_FUNC</span> <span class="p">())</span>
<a name="c0-357"></a><span class="lineno">357</span>  <span class="n">rl_forced_update_display</span> <span class="p">();</span>
<a name="c0-358"></a><span class="lineno">358</span>       <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">RL_ISSTATE</span><span class="p">(</span><span class="n">RL_STATE_REDISPLAYING</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-359"></a><span class="lineno">359</span>  <span class="n">_rl_redisplay_after_sigwinch</span> <span class="p">();</span>
<a name="c0-360"></a><span class="lineno">360</span>     <span class="p">}</span>
<a name="c0-361"></a><span class="lineno">361</span> <span class="p">}</span>
<a name="c0-362"></a><span class="lineno">362</span> 
<a name="c0-363"></a><span class="lineno">363</span> <span class="k">struct</span> <span class="n">_tc_string</span> <span class="p">{</span>
<a name="c0-364"></a><span class="lineno">364</span>      <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">tc_var</span><span class="p">;</span>
<a name="c0-365"></a><span class="lineno">365</span>      <span class="kt">char</span> <span class="o">**</span><span class="n">tc_value</span><span class="p">;</span>
<a name="c0-366"></a><span class="lineno">366</span> <span class="p">};</span>
<a name="c0-367"></a><span class="lineno">367</span> 
<a name="c0-368"></a><span class="lineno">368</span> <span class="cm">/* This should be kept sorted, just in case we decide to change the</span>
<a name="c0-369"></a><span class="lineno">369</span> <span class="cm">   search algorithm to something smarter. */</span>
<a name="c0-370"></a><span class="lineno">370</span> <span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">_tc_string</span> <span class="n">tc_strings</span><span class="p">[]</span> <span class="o">=</span>
<a name="c0-371"></a><span class="lineno">371</span> <span class="p">{</span>
<a name="c0-372"></a><span class="lineno">372</span>   <span class="p">{</span> <span class="s">"@7"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_at7</span> <span class="p">},</span>
<a name="c0-373"></a><span class="lineno">373</span>   <span class="p">{</span> <span class="s">"DC"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_DC</span> <span class="p">},</span>
<a name="c0-374"></a><span class="lineno">374</span>   <span class="p">{</span> <span class="s">"IC"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_IC</span> <span class="p">},</span>
<a name="c0-375"></a><span class="lineno">375</span>   <span class="p">{</span> <span class="s">"ce"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_clreol</span> <span class="p">},</span>
<a name="c0-376"></a><span class="lineno">376</span>   <span class="p">{</span> <span class="s">"cl"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_clrpag</span> <span class="p">},</span>
<a name="c0-377"></a><span class="lineno">377</span>   <span class="p">{</span> <span class="s">"cr"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_cr</span> <span class="p">},</span>
<a name="c0-378"></a><span class="lineno">378</span>   <span class="p">{</span> <span class="s">"dc"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_dc</span> <span class="p">},</span>
<a name="c0-379"></a><span class="lineno">379</span>   <span class="p">{</span> <span class="s">"ei"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_ei</span> <span class="p">},</span>
<a name="c0-380"></a><span class="lineno">380</span>   <span class="p">{</span> <span class="s">"ic"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_ic</span> <span class="p">},</span>
<a name="c0-381"></a><span class="lineno">381</span>   <span class="p">{</span> <span class="s">"im"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_im</span> <span class="p">},</span>
<a name="c0-382"></a><span class="lineno">382</span>   <span class="p">{</span> <span class="s">"kD"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_kD</span> <span class="p">},</span>  <span class="cm">/* delete */</span>
<a name="c0-383"></a><span class="lineno">383</span>   <span class="p">{</span> <span class="s">"kH"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_kH</span> <span class="p">},</span>  <span class="cm">/* home down ?? */</span>
<a name="c0-384"></a><span class="lineno">384</span>   <span class="p">{</span> <span class="s">"kI"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_kI</span> <span class="p">},</span>  <span class="cm">/* insert */</span>
<a name="c0-385"></a><span class="lineno">385</span>   <span class="p">{</span> <span class="s">"kd"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_kd</span> <span class="p">},</span>
<a name="c0-386"></a><span class="lineno">386</span>   <span class="p">{</span> <span class="s">"ke"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_ke</span> <span class="p">},</span>  <span class="cm">/* end keypad mode */</span>
<a name="c0-387"></a><span class="lineno">387</span>   <span class="p">{</span> <span class="s">"kh"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_kh</span> <span class="p">},</span>  <span class="cm">/* home */</span>
<a name="c0-388"></a><span class="lineno">388</span>   <span class="p">{</span> <span class="s">"kl"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_kl</span> <span class="p">},</span>
<a name="c0-389"></a><span class="lineno">389</span>   <span class="p">{</span> <span class="s">"kr"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_kr</span> <span class="p">},</span>
<a name="c0-390"></a><span class="lineno">390</span>   <span class="p">{</span> <span class="s">"ks"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_ks</span> <span class="p">},</span>  <span class="cm">/* start keypad mode */</span>
<a name="c0-391"></a><span class="lineno">391</span>   <span class="p">{</span> <span class="s">"ku"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_ku</span> <span class="p">},</span>
<a name="c0-392"></a><span class="lineno">392</span>   <span class="p">{</span> <span class="s">"le"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_backspace</span> <span class="p">},</span>
<a name="c0-393"></a><span class="lineno">393</span>   <span class="p">{</span> <span class="s">"mm"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_mm</span> <span class="p">},</span>
<a name="c0-394"></a><span class="lineno">394</span>   <span class="p">{</span> <span class="s">"mo"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_mo</span> <span class="p">},</span>
<a name="c0-395"></a><span class="lineno">395</span>   <span class="p">{</span> <span class="s">"nd"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_forward_char</span> <span class="p">},</span>
<a name="c0-396"></a><span class="lineno">396</span>   <span class="p">{</span> <span class="s">"pc"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_pc</span> <span class="p">},</span>
<a name="c0-397"></a><span class="lineno">397</span>   <span class="p">{</span> <span class="s">"up"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_up</span> <span class="p">},</span>
<a name="c0-398"></a><span class="lineno">398</span>   <span class="p">{</span> <span class="s">"vb"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_visible_bell</span> <span class="p">},</span>
<a name="c0-399"></a><span class="lineno">399</span>   <span class="p">{</span> <span class="s">"vs"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_vs</span> <span class="p">},</span>
<a name="c0-400"></a><span class="lineno">400</span>   <span class="p">{</span> <span class="s">"ve"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_term_ve</span> <span class="p">},</span>
<a name="c0-401"></a><span class="lineno">401</span> <span class="p">};</span>
<a name="c0-402"></a><span class="lineno">402</span> 
<a name="c0-403"></a><span class="lineno">403</span> <span class="cp">#define NUM_TC_STRINGS (sizeof (tc_strings) / sizeof (struct _tc_string))</span>
<a name="c0-404"></a><span class="lineno">404</span> 
<a name="c0-405"></a><span class="lineno">405</span> <span class="cm">/* Read the desired terminal capability strings into BP.  The capabilities</span>
<a name="c0-406"></a><span class="lineno">406</span> <span class="cm">   are described in the TC_STRINGS table. */</span>
<a name="c0-407"></a><span class="lineno">407</span> <span class="k">static</span> <span class="kt">void</span>
<a name="c0-408"></a><span class="lineno">408</span> <span class="n">get_term_capabilities</span> <span class="p">(</span><span class="n">bp</span><span class="p">)</span>
<a name="c0-409"></a><span class="lineno">409</span>      <span class="kt">char</span> <span class="o">**</span><span class="n">bp</span><span class="p">;</span>
<a name="c0-410"></a><span class="lineno">410</span> <span class="p">{</span>
<a name="c0-411"></a><span class="lineno">411</span> <span class="cp">#if !defined (__DJGPP__)  </span><span class="cm">/* XXX - doesn't DJGPP have a termcap library? */</span><span class="cp"></span>
<a name="c0-412"></a><span class="lineno">412</span>   <span class="k">register</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<a name="c0-413"></a><span class="lineno">413</span> 
<a name="c0-414"></a><span class="lineno">414</span>   <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_TC_STRINGS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a name="c0-415"></a><span class="lineno">415</span>     <span class="o">*</span><span class="p">(</span><span class="n">tc_strings</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">tc_value</span><span class="p">)</span> <span class="o">=</span> <span class="n">tgetstr</span> <span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">tc_strings</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">tc_var</span><span class="p">,</span> <span class="n">bp</span><span class="p">);</span>
<a name="c0-416"></a><span class="lineno">416</span> <span class="cp">#endif</span>
<a name="c0-417"></a><span class="lineno">417</span>   <span class="n">tcap_initialized</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="c0-418"></a><span class="lineno">418</span> <span class="p">}</span>
<a name="c0-419"></a><span class="lineno">419</span> 
<a name="c0-420"></a><span class="lineno">420</span> <span class="kt">int</span>
<a name="c0-421"></a><span class="lineno">421</span> <span class="n">_rl_init_terminal_io</span> <span class="p">(</span><span class="n">terminal_name</span><span class="p">)</span>
<a name="c0-422"></a><span class="lineno">422</span>      <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">terminal_name</span><span class="p">;</span>
<a name="c0-423"></a><span class="lineno">423</span> <span class="p">{</span>
<a name="c0-424"></a><span class="lineno">424</span>   <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">term</span><span class="p">;</span>
<a name="c0-425"></a><span class="lineno">425</span>   <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
<a name="c0-426"></a><span class="lineno">426</span>   <span class="kt">int</span> <span class="n">tty</span><span class="p">,</span> <span class="n">tgetent_ret</span><span class="p">;</span>
<a name="c0-427"></a><span class="lineno">427</span> 
<a name="c0-428"></a><span class="lineno">428</span>   <span class="n">term</span> <span class="o">=</span> <span class="n">terminal_name</span> <span class="o">?</span> <span class="n">terminal_name</span> <span class="o">:</span> <span class="n">sh_get_env_value</span> <span class="p">(</span><span class="s">"TERM"</span><span class="p">);</span>
<a name="c0-429"></a><span class="lineno">429</span>   <span class="n">_rl_term_clrpag</span> <span class="o">=</span> <span class="n">_rl_term_cr</span> <span class="o">=</span> <span class="n">_rl_term_clreol</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">;</span>
<a name="c0-430"></a><span class="lineno">430</span>   <span class="n">tty</span> <span class="o">=</span> <span class="n">rl_instream</span> <span class="o">?</span> <span class="n">fileno</span> <span class="p">(</span><span class="n">rl_instream</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<a name="c0-431"></a><span class="lineno">431</span> 
<a name="c0-432"></a><span class="lineno">432</span>   <span class="k">if</span> <span class="p">(</span><span class="n">term</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-433"></a><span class="lineno">433</span>     <span class="n">term</span> <span class="o">=</span> <span class="s">"dumb"</span><span class="p">;</span>
<a name="c0-434"></a><span class="lineno">434</span> 
<a name="c0-435"></a><span class="lineno">435</span>   <span class="cm">/* I've separated this out for later work on not calling tgetent at all</span>
<a name="c0-436"></a><span class="lineno">436</span> <span class="cm">     if the calling application has supplied a custom redisplay function,</span>
<a name="c0-437"></a><span class="lineno">437</span> <span class="cm">     (and possibly if the application has supplied a custom input function). */</span>
<a name="c0-438"></a><span class="lineno">438</span>   <span class="k">if</span> <span class="p">(</span><span class="n">CUSTOM_REDISPLAY_FUNC</span><span class="p">())</span>
<a name="c0-439"></a><span class="lineno">439</span>     <span class="p">{</span>
<a name="c0-440"></a><span class="lineno">440</span>       <span class="n">tgetent_ret</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<a name="c0-441"></a><span class="lineno">441</span>     <span class="p">}</span>
<a name="c0-442"></a><span class="lineno">442</span>   <span class="k">else</span>
<a name="c0-443"></a><span class="lineno">443</span>     <span class="p">{</span>
<a name="c0-444"></a><span class="lineno">444</span>       <span class="k">if</span> <span class="p">(</span><span class="n">term_string_buffer</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-445"></a><span class="lineno">445</span>  <span class="n">term_string_buffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">xmalloc</span><span class="p">(</span><span class="mi">2032</span><span class="p">);</span>
<a name="c0-446"></a><span class="lineno">446</span> 
<a name="c0-447"></a><span class="lineno">447</span>       <span class="k">if</span> <span class="p">(</span><span class="n">term_buffer</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-448"></a><span class="lineno">448</span>  <span class="n">term_buffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">xmalloc</span><span class="p">(</span><span class="mi">4080</span><span class="p">);</span>
<a name="c0-449"></a><span class="lineno">449</span> 
<a name="c0-450"></a><span class="lineno">450</span>       <span class="n">buffer</span> <span class="o">=</span> <span class="n">term_string_buffer</span><span class="p">;</span>
<a name="c0-451"></a><span class="lineno">451</span> 
<a name="c0-452"></a><span class="lineno">452</span>       <span class="n">tgetent_ret</span> <span class="o">=</span> <span class="n">tgetent</span> <span class="p">(</span><span class="n">term_buffer</span><span class="p">,</span> <span class="n">term</span><span class="p">);</span>
<a name="c0-453"></a><span class="lineno">453</span>     <span class="p">}</span>
<a name="c0-454"></a><span class="lineno">454</span> 
<a name="c0-455"></a><span class="lineno">455</span>   <span class="k">if</span> <span class="p">(</span><span class="n">tgetent_ret</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-456"></a><span class="lineno">456</span>     <span class="p">{</span>
<a name="c0-457"></a><span class="lineno">457</span>       <span class="n">FREE</span> <span class="p">(</span><span class="n">term_string_buffer</span><span class="p">);</span>
<a name="c0-458"></a><span class="lineno">458</span>       <span class="n">FREE</span> <span class="p">(</span><span class="n">term_buffer</span><span class="p">);</span>
<a name="c0-459"></a><span class="lineno">459</span>       <span class="n">buffer</span> <span class="o">=</span> <span class="n">term_buffer</span> <span class="o">=</span> <span class="n">term_string_buffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">;</span>
<a name="c0-460"></a><span class="lineno">460</span> 
<a name="c0-461"></a><span class="lineno">461</span>       <span class="n">_rl_term_autowrap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="cm">/* used by _rl_get_screen_size */</span>
<a name="c0-462"></a><span class="lineno">462</span> 
<a name="c0-463"></a><span class="lineno">463</span>       <span class="cm">/* Allow calling application to set default height and width, using</span>
<a name="c0-464"></a><span class="lineno">464</span> <span class="cm">   rl_set_screen_size */</span>
<a name="c0-465"></a><span class="lineno">465</span>       <span class="k">if</span> <span class="p">(</span><span class="n">_rl_screenwidth</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">_rl_screenheight</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-466"></a><span class="lineno">466</span>  <span class="p">{</span>
<a name="c0-467"></a><span class="lineno">467</span> <span class="cp">#if defined (__EMX__)</span>
<a name="c0-468"></a><span class="lineno">468</span>    <span class="n">_emx_get_screensize</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">_rl_screenwidth</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">_rl_screenheight</span><span class="p">);</span>
<a name="c0-469"></a><span class="lineno">469</span>    <span class="n">_rl_screenwidth</span><span class="o">--</span><span class="p">;</span>
<a name="c0-470"></a><span class="lineno">470</span> <span class="cp">#else </span><span class="cm">/* !__EMX__ */</span><span class="cp"></span>
<a name="c0-471"></a><span class="lineno">471</span>    <span class="n">_rl_get_screen_size</span> <span class="p">(</span><span class="n">tty</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<a name="c0-472"></a><span class="lineno">472</span> <span class="cp">#endif </span><span class="cm">/* !__EMX__ */</span><span class="cp"></span>
<a name="c0-473"></a><span class="lineno">473</span>  <span class="p">}</span>
<a name="c0-474"></a><span class="lineno">474</span> 
<a name="c0-475"></a><span class="lineno">475</span>       <span class="cm">/* Defaults. */</span>
<a name="c0-476"></a><span class="lineno">476</span>       <span class="k">if</span> <span class="p">(</span><span class="n">_rl_screenwidth</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">_rl_screenheight</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-477"></a><span class="lineno">477</span>         <span class="p">{</span>
<a name="c0-478"></a><span class="lineno">478</span>    <span class="n">_rl_screenwidth</span> <span class="o">=</span> <span class="mi">79</span><span class="p">;</span>
<a name="c0-479"></a><span class="lineno">479</span>    <span class="n">_rl_screenheight</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span>
<a name="c0-480"></a><span class="lineno">480</span>         <span class="p">}</span>
<a name="c0-481"></a><span class="lineno">481</span> 
<a name="c0-482"></a><span class="lineno">482</span>       <span class="cm">/* Everything below here is used by the redisplay code (tputs). */</span>
<a name="c0-483"></a><span class="lineno">483</span>       <span class="n">_rl_screenchars</span> <span class="o">=</span> <span class="n">_rl_screenwidth</span> <span class="o">*</span> <span class="n">_rl_screenheight</span><span class="p">;</span>
<a name="c0-484"></a><span class="lineno">484</span>       <span class="n">_rl_term_cr</span> <span class="o">=</span> <span class="s">"</span><span class="se">\r</span><span class="s">"</span><span class="p">;</span>
<a name="c0-485"></a><span class="lineno">485</span>       <span class="n">_rl_term_im</span> <span class="o">=</span> <span class="n">_rl_term_ei</span> <span class="o">=</span> <span class="n">_rl_term_ic</span> <span class="o">=</span> <span class="n">_rl_term_IC</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">;</span>
<a name="c0-486"></a><span class="lineno">486</span>       <span class="n">_rl_term_up</span> <span class="o">=</span> <span class="n">_rl_term_dc</span> <span class="o">=</span> <span class="n">_rl_term_DC</span> <span class="o">=</span> <span class="n">_rl_visible_bell</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">;</span>
<a name="c0-487"></a><span class="lineno">487</span>       <span class="n">_rl_term_ku</span> <span class="o">=</span> <span class="n">_rl_term_kd</span> <span class="o">=</span> <span class="n">_rl_term_kl</span> <span class="o">=</span> <span class="n">_rl_term_kr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">;</span>
<a name="c0-488"></a><span class="lineno">488</span>       <span class="n">_rl_term_kh</span> <span class="o">=</span> <span class="n">_rl_term_kH</span> <span class="o">=</span> <span class="n">_rl_term_kI</span> <span class="o">=</span> <span class="n">_rl_term_kD</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">;</span>
<a name="c0-489"></a><span class="lineno">489</span>       <span class="n">_rl_term_ks</span> <span class="o">=</span> <span class="n">_rl_term_ke</span> <span class="o">=</span> <span class="n">_rl_term_at7</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">;</span>
<a name="c0-490"></a><span class="lineno">490</span>       <span class="n">_rl_term_mm</span> <span class="o">=</span> <span class="n">_rl_term_mo</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">;</span>
<a name="c0-491"></a><span class="lineno">491</span>       <span class="n">_rl_term_ve</span> <span class="o">=</span> <span class="n">_rl_term_vs</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">;</span>
<a name="c0-492"></a><span class="lineno">492</span>       <span class="n">_rl_term_forward_char</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">;</span>
<a name="c0-493"></a><span class="lineno">493</span>       <span class="n">_rl_terminal_can_insert</span> <span class="o">=</span> <span class="n">term_has_meta</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="c0-494"></a><span class="lineno">494</span> 
<a name="c0-495"></a><span class="lineno">495</span>       <span class="cm">/* Reasonable defaults for tgoto().  Readline currently only uses</span>
<a name="c0-496"></a><span class="lineno">496</span> <span class="cm">         tgoto if _rl_term_IC or _rl_term_DC is defined, but just in case we</span>
<a name="c0-497"></a><span class="lineno">497</span> <span class="cm">         change that later... */</span>
<a name="c0-498"></a><span class="lineno">498</span>       <span class="n">PC</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
<a name="c0-499"></a><span class="lineno">499</span>       <span class="n">BC</span> <span class="o">=</span> <span class="n">_rl_term_backspace</span> <span class="o">=</span> <span class="s">"</span><span class="se">\b</span><span class="s">"</span><span class="p">;</span>
<a name="c0-500"></a><span class="lineno">500</span>       <span class="n">UP</span> <span class="o">=</span> <span class="n">_rl_term_up</span><span class="p">;</span>
<a name="c0-501"></a><span class="lineno">501</span> 
<a name="c0-502"></a><span class="lineno">502</span>       <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<a name="c0-503"></a><span class="lineno">503</span>     <span class="p">}</span>
<a name="c0-504"></a><span class="lineno">504</span> 
<a name="c0-505"></a><span class="lineno">505</span>   <span class="n">get_term_capabilities</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">);</span>
<a name="c0-506"></a><span class="lineno">506</span> 
<a name="c0-507"></a><span class="lineno">507</span>   <span class="cm">/* Set up the variables that the termcap library expects the application</span>
<a name="c0-508"></a><span class="lineno">508</span> <span class="cm">     to provide. */</span>
<a name="c0-509"></a><span class="lineno">509</span>   <span class="n">PC</span> <span class="o">=</span> <span class="n">_rl_term_pc</span> <span class="o">?</span> <span class="o">*</span><span class="n">_rl_term_pc</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<a name="c0-510"></a><span class="lineno">510</span>   <span class="n">BC</span> <span class="o">=</span> <span class="n">_rl_term_backspace</span><span class="p">;</span>
<a name="c0-511"></a><span class="lineno">511</span>   <span class="n">UP</span> <span class="o">=</span> <span class="n">_rl_term_up</span><span class="p">;</span>
<a name="c0-512"></a><span class="lineno">512</span> 
<a name="c0-513"></a><span class="lineno">513</span>   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">_rl_term_cr</span><span class="p">)</span>
<a name="c0-514"></a><span class="lineno">514</span>     <span class="n">_rl_term_cr</span> <span class="o">=</span> <span class="s">"</span><span class="se">\r</span><span class="s">"</span><span class="p">;</span>
<a name="c0-515"></a><span class="lineno">515</span> 
<a name="c0-516"></a><span class="lineno">516</span>   <span class="n">_rl_term_autowrap</span> <span class="o">=</span> <span class="n">tgetflag</span> <span class="p">(</span><span class="s">"am"</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">tgetflag</span> <span class="p">(</span><span class="s">"xn"</span><span class="p">);</span>
<a name="c0-517"></a><span class="lineno">517</span> 
<a name="c0-518"></a><span class="lineno">518</span>   <span class="cm">/* Allow calling application to set default height and width, using</span>
<a name="c0-519"></a><span class="lineno">519</span> <span class="cm">     rl_set_screen_size */</span>
<a name="c0-520"></a><span class="lineno">520</span>   <span class="k">if</span> <span class="p">(</span><span class="n">_rl_screenwidth</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">_rl_screenheight</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-521"></a><span class="lineno">521</span>     <span class="n">_rl_get_screen_size</span> <span class="p">(</span><span class="n">tty</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<a name="c0-522"></a><span class="lineno">522</span> 
<a name="c0-523"></a><span class="lineno">523</span>   <span class="cm">/* "An application program can assume that the terminal can do</span>
<a name="c0-524"></a><span class="lineno">524</span> <span class="cm">      character insertion if *any one of* the capabilities `IC',</span>
<a name="c0-525"></a><span class="lineno">525</span> <span class="cm">      `im', `ic' or `ip' is provided."  But we can't do anything if</span>
<a name="c0-526"></a><span class="lineno">526</span> <span class="cm">      only `ip' is provided, so... */</span>
<a name="c0-527"></a><span class="lineno">527</span>   <span class="n">_rl_terminal_can_insert</span> <span class="o">=</span> <span class="p">(</span><span class="n">_rl_term_IC</span> <span class="o">||</span> <span class="n">_rl_term_im</span> <span class="o">||</span> <span class="n">_rl_term_ic</span><span class="p">);</span>
<a name="c0-528"></a><span class="lineno">528</span> 
<a name="c0-529"></a><span class="lineno">529</span>   <span class="cm">/* Check to see if this terminal has a meta key and clear the capability</span>
<a name="c0-530"></a><span class="lineno">530</span> <span class="cm">     variables if there is none. */</span>
<a name="c0-531"></a><span class="lineno">531</span>   <span class="n">term_has_meta</span> <span class="o">=</span> <span class="n">tgetflag</span> <span class="p">(</span><span class="s">"km"</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
<a name="c0-532"></a><span class="lineno">532</span>   <span class="k">if</span> <span class="p">(</span><span class="n">term_has_meta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-533"></a><span class="lineno">533</span>     <span class="n">_rl_term_mm</span> <span class="o">=</span> <span class="n">_rl_term_mo</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">;</span>
<a name="c0-534"></a><span class="lineno">534</span> 
<a name="c0-535"></a><span class="lineno">535</span>   <span class="cm">/* Attempt to find and bind the arrow keys.  Do not override already</span>
<a name="c0-536"></a><span class="lineno">536</span> <span class="cm">     bound keys in an overzealous attempt, however. */</span>
<a name="c0-537"></a><span class="lineno">537</span> 
<a name="c0-538"></a><span class="lineno">538</span>   <span class="n">bind_termcap_arrow_keys</span> <span class="p">(</span><span class="n">emacs_standard_keymap</span><span class="p">);</span>
<a name="c0-539"></a><span class="lineno">539</span> 
<a name="c0-540"></a><span class="lineno">540</span> <span class="cp">#if defined (VI_MODE)</span>
<a name="c0-541"></a><span class="lineno">541</span>   <span class="n">bind_termcap_arrow_keys</span> <span class="p">(</span><span class="n">vi_movement_keymap</span><span class="p">);</span>
<a name="c0-542"></a><span class="lineno">542</span>   <span class="n">bind_termcap_arrow_keys</span> <span class="p">(</span><span class="n">vi_insertion_keymap</span><span class="p">);</span>
<a name="c0-543"></a><span class="lineno">543</span> <span class="cp">#endif </span><span class="cm">/* VI_MODE */</span><span class="cp"></span>
<a name="c0-544"></a><span class="lineno">544</span> 
<a name="c0-545"></a><span class="lineno">545</span>   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<a name="c0-546"></a><span class="lineno">546</span> <span class="p">}</span>
<a name="c0-547"></a><span class="lineno">547</span> 
<a name="c0-548"></a><span class="lineno">548</span> <span class="cm">/* Bind the arrow key sequences from the termcap description in MAP. */</span>
<a name="c0-549"></a><span class="lineno">549</span> <span class="k">static</span> <span class="kt">void</span>
<a name="c0-550"></a><span class="lineno">550</span> <span class="n">bind_termcap_arrow_keys</span> <span class="p">(</span><span class="n">map</span><span class="p">)</span>
<a name="c0-551"></a><span class="lineno">551</span>      <span class="n">Keymap</span> <span class="n">map</span><span class="p">;</span>
<a name="c0-552"></a><span class="lineno">552</span> <span class="p">{</span>
<a name="c0-553"></a><span class="lineno">553</span>   <span class="n">Keymap</span> <span class="n">xkeymap</span><span class="p">;</span>
<a name="c0-554"></a><span class="lineno">554</span> 
<a name="c0-555"></a><span class="lineno">555</span>   <span class="n">xkeymap</span> <span class="o">=</span> <span class="n">_rl_keymap</span><span class="p">;</span>
<a name="c0-556"></a><span class="lineno">556</span> <span class="hll">  <span class="n">_rl_keymap</span> <span class="o">=</span> <span class="n">map</span><span class="p">;</span>
</span><a name="c0-557"></a><span class="lineno">557</span> <span class="hll">
</span><a name="c0-558"></a><span class="lineno">558</span> <span class="hll">  <span class="n">rl_bind_keyseq_if_unbound</span> <span class="p">(</span><span class="n">_rl_term_ku</span><span class="p">,</span> <span class="n">rl_get_previous_history</span><span class="p">);</span>
</span><a name="c0-559"></a><span class="lineno">559</span> <span class="hll">  <span class="n">rl_bind_keyseq_if_unbound</span> <span class="p">(</span><span class="n">_rl_term_kd</span><span class="p">,</span> <span class="n">rl_get_next_history</span><span class="p">);</span>
</span><a name="c0-560"></a><span class="lineno">560</span> <span class="hll">  <span class="n">rl_bind_keyseq_if_unbound</span> <span class="p">(</span><span class="n">_rl_term_kr</span><span class="p">,</span> <span class="n">rl_forward_char</span><span class="p">);</span>
</span><a name="c0-561"></a><span class="lineno">561</span> <span class="hll">  <span class="n">rl_bind_keyseq_if_unbound</span> <span class="p">(</span><span class="n">_rl_term_kl</span><span class="p">,</span> <span class="n">rl_backward_char</span><span class="p">);</span>
</span><a name="c0-562"></a><span class="lineno">562</span> <span class="hll">
</span><a name="c0-563"></a><span class="lineno">563</span> <span class="hll">  <span class="n">rl_bind_keyseq_if_unbound</span> <span class="p">(</span><span class="n">_rl_term_kh</span><span class="p">,</span> <span class="n">rl_beg_of_line</span><span class="p">);</span>  <span class="cm">/* Home */</span>
</span><a name="c0-564"></a><span class="lineno">564</span> <span class="hll">  <span class="n">rl_bind_keyseq_if_unbound</span> <span class="p">(</span><span class="n">_rl_term_at7</span><span class="p">,</span> <span class="n">rl_end_of_line</span><span class="p">);</span> <span class="cm">/* End */</span>
</span><a name="c0-565"></a><span class="lineno">565</span> <span class="hll">
</span><a name="c0-566"></a><span class="lineno">566</span> <span class="hll">  <span class="n">rl_bind_keyseq_if_unbound</span> <span class="p">(</span><span class="n">_rl_term_kD</span><span class="p">,</span> <span class="n">rl_delete</span><span class="p">);</span>
</span><a name="c0-567"></a><span class="lineno">567</span> <span class="hll">
</span><a name="c0-568"></a><span class="lineno">568</span> <span class="hll">  <span class="n">_rl_keymap</span> <span class="o">=</span> <span class="n">xkeymap</span><span class="p">;</span>
</span><a name="c0-569"></a><span class="lineno">569</span> <span class="p">}</span>
<a name="c0-570"></a><span class="lineno">570</span> 
<a name="c0-571"></a><span class="lineno">571</span> <span class="kt">char</span> <span class="o">*</span>
<a name="c0-572"></a><span class="lineno">572</span> <span class="n">rl_get_termcap</span> <span class="p">(</span><span class="n">cap</span><span class="p">)</span>
<a name="c0-573"></a><span class="lineno">573</span>      <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cap</span><span class="p">;</span>
<a name="c0-574"></a><span class="lineno">574</span> <span class="p">{</span>
<a name="c0-575"></a><span class="lineno">575</span>   <span class="k">register</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<a name="c0-576"></a><span class="lineno">576</span> 
<a name="c0-577"></a><span class="lineno">577</span>   <span class="k">if</span> <span class="p">(</span><span class="n">tcap_initialized</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-578"></a><span class="lineno">578</span>     <span class="k">return</span> <span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">);</span>
<a name="c0-579"></a><span class="lineno">579</span>   <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_TC_STRINGS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a name="c0-580"></a><span class="lineno">580</span>     <span class="p">{</span>
<a name="c0-581"></a><span class="lineno">581</span>       <span class="k">if</span> <span class="p">(</span><span class="n">tc_strings</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">tc_var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">cap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">strcmp</span> <span class="p">(</span><span class="n">tc_strings</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">tc_var</span><span class="p">,</span> <span class="n">cap</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="c0-582"></a><span class="lineno">582</span>         <span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="n">tc_strings</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">tc_value</span><span class="p">);</span>
<a name="c0-583"></a><span class="lineno">583</span>     <span class="p">}</span>
<a name="c0-584"></a><span class="lineno">584</span>   <span class="k">return</span> <span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">);</span>
<a name="c0-585"></a><span class="lineno">585</span> <span class="p">}</span>
<a name="c0-586"></a><span class="lineno">586</span> 
<a name="c0-587"></a><span class="lineno">587</span> <span class="cm">/* Re-initialize the terminal considering that the TERM/TERMCAP variable</span>
<a name="c0-588"></a><span class="lineno">588</span> <span class="cm">   has changed. */</span>
<a name="c0-589"></a><span class="lineno">589</span> <span class="kt">int</span>
<a name="c0-590"></a><span class="lineno">590</span> <span class="n">rl_reset_terminal</span> <span class="p">(</span><span class="n">terminal_name</span><span class="p">)</span>
<a name="c0-591"></a><span class="lineno">591</span>      <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">terminal_name</span><span class="p">;</span>
<a name="c0-592"></a><span class="lineno">592</span> <span class="p">{</span>
<a name="c0-593"></a><span class="lineno">593</span>   <span class="n">_rl_screenwidth</span> <span class="o">=</span> <span class="n">_rl_screenheight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="c0-594"></a><span class="lineno">594</span>   <span class="n">_rl_init_terminal_io</span> <span class="p">(</span><span class="n">terminal_name</span><span class="p">);</span>
<a name="c0-595"></a><span class="lineno">595</span>   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<a name="c0-596"></a><span class="lineno">596</span> <span class="p">}</span>
<a name="c0-597"></a><span class="lineno">597</span> 
<a name="c0-598"></a><span class="lineno">598</span> <span class="cm">/* A function for the use of tputs () */</span>
<a name="c0-599"></a><span class="lineno">599</span> <span class="cp">#ifdef _MINIX</span>
<a name="c0-600"></a><span class="lineno">600</span> <span class="kt">void</span>
<a name="c0-601"></a><span class="lineno">601</span> <span class="n">_rl_output_character_function</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a name="c0-602"></a><span class="lineno">602</span>      <span class="kt">int</span> <span class="n">c</span><span class="p">;</span>
<a name="c0-603"></a><span class="lineno">603</span> <span class="p">{</span>
<a name="c0-604"></a><span class="lineno">604</span>   <span class="n">putc</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">_rl_out_stream</span><span class="p">);</span>
<a name="c0-605"></a><span class="lineno">605</span> <span class="p">}</span>
<a name="c0-606"></a><span class="lineno">606</span> <span class="cp">#else </span><span class="cm">/* !_MINIX */</span><span class="cp"></span>
<a name="c0-607"></a><span class="lineno">607</span> <span class="kt">int</span>
<a name="c0-608"></a><span class="lineno">608</span> <span class="n">_rl_output_character_function</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a name="c0-609"></a><span class="lineno">609</span>      <span class="kt">int</span> <span class="n">c</span><span class="p">;</span>
<a name="c0-610"></a><span class="lineno">610</span> <span class="p">{</span>
<a name="c0-611"></a><span class="lineno">611</span>   <span class="k">return</span> <span class="n">putc</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">_rl_out_stream</span><span class="p">);</span>
<a name="c0-612"></a><span class="lineno">612</span> <span class="p">}</span>
<a name="c0-613"></a><span class="lineno">613</span> <span class="cp">#endif </span><span class="cm">/* !_MINIX */</span><span class="cp"></span>
<a name="c0-614"></a><span class="lineno">614</span> 
<a name="c0-615"></a><span class="lineno">615</span> <span class="cm">/* Write COUNT characters from STRING to the output stream. */</span>
<a name="c0-616"></a><span class="lineno">616</span> <span class="kt">void</span>
<a name="c0-617"></a><span class="lineno">617</span> <span class="n">_rl_output_some_chars</span> <span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
<a name="c0-618"></a><span class="lineno">618</span>      <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">string</span><span class="p">;</span>
<a name="c0-619"></a><span class="lineno">619</span>      <span class="kt">int</span> <span class="n">count</span><span class="p">;</span>
<a name="c0-620"></a><span class="lineno">620</span> <span class="p">{</span>
<a name="c0-621"></a><span class="lineno">621</span>   <span class="n">fwrite</span> <span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">_rl_out_stream</span><span class="p">);</span>
<a name="c0-622"></a><span class="lineno">622</span> <span class="p">}</span>
<a name="c0-623"></a><span class="lineno">623</span> 
<a name="c0-624"></a><span class="lineno">624</span> <span class="cm">/* Move the cursor back. */</span>
<a name="c0-625"></a><span class="lineno">625</span> <span class="kt">int</span>
<a name="c0-626"></a><span class="lineno">626</span> <span class="n">_rl_backspace</span> <span class="p">(</span><span class="n">count</span><span class="p">)</span>
<a name="c0-627"></a><span class="lineno">627</span>      <span class="kt">int</span> <span class="n">count</span><span class="p">;</span>
<a name="c0-628"></a><span class="lineno">628</span> <span class="p">{</span>
<a name="c0-629"></a><span class="lineno">629</span>   <span class="k">register</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<a name="c0-630"></a><span class="lineno">630</span> 
<a name="c0-631"></a><span class="lineno">631</span>   <span class="k">if</span> <span class="p">(</span><span class="n">_rl_term_backspace</span><span class="p">)</span>
<a name="c0-632"></a><span class="lineno">632</span>     <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a name="c0-633"></a><span class="lineno">633</span>       <span class="n">tputs</span> <span class="p">(</span><span class="n">_rl_term_backspace</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_rl_output_character_function</span><span class="p">);</span>
<a name="c0-634"></a><span class="lineno">634</span>   <span class="k">else</span>
<a name="c0-635"></a><span class="lineno">635</span>     <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a name="c0-636"></a><span class="lineno">636</span>       <span class="n">putc</span> <span class="p">(</span><span class="sc">'\b'</span><span class="p">,</span> <span class="n">_rl_out_stream</span><span class="p">);</span>
<a name="c0-637"></a><span class="lineno">637</span>   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<a name="c0-638"></a><span class="lineno">638</span> <span class="p">}</span>
<a name="c0-639"></a><span class="lineno">639</span> 
<a name="c0-640"></a><span class="lineno">640</span> <span class="cm">/* Move to the start of the next line. */</span>
<a name="c0-641"></a><span class="lineno">641</span> <span class="kt">int</span>
<a name="c0-642"></a><span class="lineno">642</span> <span class="n">rl_crlf</span> <span class="p">()</span>
<a name="c0-643"></a><span class="lineno">643</span> <span class="p">{</span>
<a name="c0-644"></a><span class="lineno">644</span> <span class="cp">#if defined (NEW_TTY_DRIVER) || defined (__MINT__)</span>
<a name="c0-645"></a><span class="lineno">645</span>   <span class="k">if</span> <span class="p">(</span><span class="n">_rl_term_cr</span><span class="p">)</span>
<a name="c0-646"></a><span class="lineno">646</span>     <span class="n">tputs</span> <span class="p">(</span><span class="n">_rl_term_cr</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_rl_output_character_function</span><span class="p">);</span>
<a name="c0-647"></a><span class="lineno">647</span> <span class="cp">#endif </span><span class="cm">/* NEW_TTY_DRIVER || __MINT__ */</span><span class="cp"></span>
<a name="c0-648"></a><span class="lineno">648</span>   <span class="n">putc</span> <span class="p">(</span><span class="sc">'\n'</span><span class="p">,</span> <span class="n">_rl_out_stream</span><span class="p">);</span>
<a name="c0-649"></a><span class="lineno">649</span>   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<a name="c0-650"></a><span class="lineno">650</span> <span class="p">}</span>
<a name="c0-651"></a><span class="lineno">651</span> 
<a name="c0-652"></a><span class="lineno">652</span> <span class="cm">/* Ring the terminal bell. */</span>
<a name="c0-653"></a><span class="lineno">653</span> <span class="kt">int</span>
<a name="c0-654"></a><span class="lineno">654</span> <span class="n">rl_ding</span> <span class="p">()</span>
<a name="c0-655"></a><span class="lineno">655</span> <span class="p">{</span>
<a name="c0-656"></a><span class="lineno">656</span>   <span class="k">if</span> <span class="p">(</span><span class="n">_rl_echoing_p</span><span class="p">)</span>
<a name="c0-657"></a><span class="lineno">657</span>     <span class="p">{</span>
<a name="c0-658"></a><span class="lineno">658</span>       <span class="k">switch</span> <span class="p">(</span><span class="n">_rl_bell_preference</span><span class="p">)</span>
<a name="c0-659"></a><span class="lineno">659</span>         <span class="p">{</span>
<a name="c0-660"></a><span class="lineno">660</span>  <span class="k">case</span> <span class="n">NO_BELL</span>:
<a name="c0-661"></a><span class="lineno">661</span>  <span class="nl">default:</span>
<a name="c0-662"></a><span class="lineno">662</span>    <span class="k">break</span><span class="p">;</span>
<a name="c0-663"></a><span class="lineno">663</span>  <span class="k">case</span> <span class="n">VISIBLE_BELL</span>:
<a name="c0-664"></a><span class="lineno">664</span>    <span class="k">if</span> <span class="p">(</span><span class="n">_rl_visible_bell</span><span class="p">)</span>
<a name="c0-665"></a><span class="lineno">665</span>      <span class="p">{</span>
<a name="c0-666"></a><span class="lineno">666</span>        <span class="n">tputs</span> <span class="p">(</span><span class="n">_rl_visible_bell</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_rl_output_character_function</span><span class="p">);</span>
<a name="c0-667"></a><span class="lineno">667</span>        <span class="k">break</span><span class="p">;</span>
<a name="c0-668"></a><span class="lineno">668</span>      <span class="p">}</span>
<a name="c0-669"></a><span class="lineno">669</span>    <span class="cm">/* FALLTHROUGH */</span>
<a name="c0-670"></a><span class="lineno">670</span>  <span class="k">case</span> <span class="n">AUDIBLE_BELL</span>:
<a name="c0-671"></a><span class="lineno">671</span>    <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"</span><span class="se">\007</span><span class="s">"</span><span class="p">);</span>
<a name="c0-672"></a><span class="lineno">672</span>    <span class="n">fflush</span> <span class="p">(</span><span class="n">stderr</span><span class="p">);</span>
<a name="c0-673"></a><span class="lineno">673</span>    <span class="k">break</span><span class="p">;</span>
<a name="c0-674"></a><span class="lineno">674</span>         <span class="p">}</span>
<a name="c0-675"></a><span class="lineno">675</span>       <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a name="c0-676"></a><span class="lineno">676</span>     <span class="p">}</span>
<a name="c0-677"></a><span class="lineno">677</span>   <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<a name="c0-678"></a><span class="lineno">678</span> <span class="p">}</span>
<a name="c0-679"></a><span class="lineno">679</span> 
<a name="c0-680"></a><span class="lineno">680</span> <span class="cm">/* **************************************************************** */</span>
<a name="c0-681"></a><span class="lineno">681</span> <span class="cm">/*                    */</span>
<a name="c0-682"></a><span class="lineno">682</span> <span class="cm">/*    Controlling the Meta Key and Keypad       */</span>
<a name="c0-683"></a><span class="lineno">683</span> <span class="cm">/*                    */</span>
<a name="c0-684"></a><span class="lineno">684</span> <span class="cm">/* **************************************************************** */</span>
<a name="c0-685"></a><span class="lineno">685</span> 
<a name="c0-686"></a><span class="lineno">686</span> <span class="kt">void</span>
<a name="c0-687"></a><span class="lineno">687</span> <span class="n">_rl_enable_meta_key</span> <span class="p">()</span>
<a name="c0-688"></a><span class="lineno">688</span> <span class="p">{</span>
<a name="c0-689"></a><span class="lineno">689</span> <span class="cp">#if !defined (__DJGPP__)</span>
<a name="c0-690"></a><span class="lineno">690</span>   <span class="k">if</span> <span class="p">(</span><span class="n">term_has_meta</span> <span class="o">&amp;&amp;</span> <span class="n">_rl_term_mm</span><span class="p">)</span>
<a name="c0-691"></a><span class="lineno">691</span>     <span class="n">tputs</span> <span class="p">(</span><span class="n">_rl_term_mm</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_rl_output_character_function</span><span class="p">);</span>
<a name="c0-692"></a><span class="lineno">692</span> <span class="cp">#endif</span>
<a name="c0-693"></a><span class="lineno">693</span> <span class="p">}</span>
<a name="c0-694"></a><span class="lineno">694</span> 
<a name="c0-695"></a><span class="lineno">695</span> <span class="kt">void</span>
<a name="c0-696"></a><span class="lineno">696</span> <span class="n">_rl_control_keypad</span> <span class="p">(</span><span class="n">on</span><span class="p">)</span>
<a name="c0-697"></a><span class="lineno">697</span>      <span class="kt">int</span> <span class="n">on</span><span class="p">;</span>
<a name="c0-698"></a><span class="lineno">698</span> <span class="p">{</span>
<a name="c0-699"></a><span class="lineno">699</span> <span class="cp">#if !defined (__DJGPP__)</span>
<a name="c0-700"></a><span class="lineno">700</span>   <span class="k">if</span> <span class="p">(</span><span class="n">on</span> <span class="o">&amp;&amp;</span> <span class="n">_rl_term_ks</span><span class="p">)</span>
<a name="c0-701"></a><span class="lineno">701</span>     <span class="n">tputs</span> <span class="p">(</span><span class="n">_rl_term_ks</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_rl_output_character_function</span><span class="p">);</span>
<a name="c0-702"></a><span class="lineno">702</span>   <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">on</span> <span class="o">&amp;&amp;</span> <span class="n">_rl_term_ke</span><span class="p">)</span>
<a name="c0-703"></a><span class="lineno">703</span>     <span class="n">tputs</span> <span class="p">(</span><span class="n">_rl_term_ke</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_rl_output_character_function</span><span class="p">);</span>
<a name="c0-704"></a><span class="lineno">704</span> <span class="cp">#endif</span>
<a name="c0-705"></a><span class="lineno">705</span> <span class="p">}</span>
<a name="c0-706"></a><span class="lineno">706</span> 
<a name="c0-707"></a><span class="lineno">707</span> <span class="cm">/* **************************************************************** */</span>
<a name="c0-708"></a><span class="lineno">708</span> <span class="cm">/*                    */</span>
<a name="c0-709"></a><span class="lineno">709</span> <span class="cm">/*      Controlling the Cursor          */</span>
<a name="c0-710"></a><span class="lineno">710</span> <span class="cm">/*                    */</span>
<a name="c0-711"></a><span class="lineno">711</span> <span class="cm">/* **************************************************************** */</span>
<a name="c0-712"></a><span class="lineno">712</span> 
<a name="c0-713"></a><span class="lineno">713</span> <span class="cm">/* Set the cursor appropriately depending on IM, which is one of the</span>
<a name="c0-714"></a><span class="lineno">714</span> <span class="cm">   insert modes (insert or overwrite).  Insert mode gets the normal</span>
<a name="c0-715"></a><span class="lineno">715</span> <span class="cm">   cursor.  Overwrite mode gets a very visible cursor.  Only does</span>
<a name="c0-716"></a><span class="lineno">716</span> <span class="cm">   anything if we have both capabilities. */</span>
<a name="c0-717"></a><span class="lineno">717</span> <span class="kt">void</span>
<a name="c0-718"></a><span class="lineno">718</span> <span class="n">_rl_set_cursor</span> <span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
<a name="c0-719"></a><span class="lineno">719</span>      <span class="kt">int</span> <span class="n">im</span><span class="p">,</span> <span class="n">force</span><span class="p">;</span>
<a name="c0-720"></a><span class="lineno">720</span> <span class="p">{</span>
<a name="c0-721"></a><span class="lineno">721</span>   <span class="k">if</span> <span class="p">(</span><span class="n">_rl_term_ve</span> <span class="o">&amp;&amp;</span> <span class="n">_rl_term_vs</span><span class="p">)</span>
<a name="c0-722"></a><span class="lineno">722</span>     <span class="p">{</span>
<a name="c0-723"></a><span class="lineno">723</span>       <span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">im</span> <span class="o">!=</span> <span class="n">rl_insert_mode</span><span class="p">)</span>
<a name="c0-724"></a><span class="lineno">724</span>  <span class="p">{</span>
<a name="c0-725"></a><span class="lineno">725</span>    <span class="k">if</span> <span class="p">(</span><span class="n">im</span> <span class="o">==</span> <span class="n">RL_IM_OVERWRITE</span><span class="p">)</span>
<a name="c0-726"></a><span class="lineno">726</span>      <span class="n">tputs</span> <span class="p">(</span><span class="n">_rl_term_vs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_rl_output_character_function</span><span class="p">);</span>
<a name="c0-727"></a><span class="lineno">727</span>    <span class="k">else</span>
<a name="c0-728"></a><span class="lineno">728</span>      <span class="n">tputs</span> <span class="p">(</span><span class="n">_rl_term_ve</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_rl_output_character_function</span><span class="p">);</span>
<a name="c0-729"></a><span class="lineno">729</span>  <span class="p">}</span>
<a name="c0-730"></a><span class="lineno">730</span>     <span class="p">}</span>
<a name="c0-731"></a><span class="lineno">731</span> <span class="p">}</span>
</pre></div>

                </div>
                <div class="scrollable-sections-bottom-shadow" style="opacity: 5.5;"></div>
            </div>
        </div>
        
        <div class="codebox" style="width: 50%; ">
            <h3> mksyntax.c 
                <small> (219,25)-(234,11)
                </small>
            </h3>
            
            <div class="scrollable-holder">
                <div class="scrollable-sections-top-shadow" style="opacity: 5.5;"></div>
                <div class="scrollbox" data-padding-bottom="20" id="code-scrollbox-1" style="max-height: 752px; ">
                    <div class="highlight"><pre><a name="c1-1"></a><span class="lineno">  1</span> <span class="cm">/*</span>
<a name="c1-2"></a><span class="lineno">  2</span> <span class="cm"> * mksyntax.c - construct shell syntax table for fast char attribute lookup.</span>
<a name="c1-3"></a><span class="lineno">  3</span> <span class="cm"> */</span>
<a name="c1-4"></a><span class="lineno">  4</span> 
<a name="c1-5"></a><span class="lineno">  5</span> <span class="cm">/* Copyright (C) 2000-2009 Free Software Foundation, Inc.</span>
<a name="c1-6"></a><span class="lineno">  6</span> 
<a name="c1-7"></a><span class="lineno">  7</span> <span class="cm">   This file is part of GNU Bash, the Bourne Again SHell.</span>
<a name="c1-8"></a><span class="lineno">  8</span> 
<a name="c1-9"></a><span class="lineno">  9</span> <span class="cm">   Bash is free software: you can redistribute it and/or modify</span>
<a name="c1-10"></a><span class="lineno"> 10</span> <span class="cm">   it under the terms of the GNU General Public License as published by</span>
<a name="c1-11"></a><span class="lineno"> 11</span> <span class="cm">   the Free Software Foundation, either version 3 of the License, or</span>
<a name="c1-12"></a><span class="lineno"> 12</span> <span class="cm">   (at your option) any later version.</span>
<a name="c1-13"></a><span class="lineno"> 13</span> 
<a name="c1-14"></a><span class="lineno"> 14</span> <span class="cm">   Bash is distributed in the hope that it will be useful,</span>
<a name="c1-15"></a><span class="lineno"> 15</span> <span class="cm">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="c1-16"></a><span class="lineno"> 16</span> <span class="cm">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="c1-17"></a><span class="lineno"> 17</span> <span class="cm">   GNU General Public License for more details.</span>
<a name="c1-18"></a><span class="lineno"> 18</span> 
<a name="c1-19"></a><span class="lineno"> 19</span> <span class="cm">   You should have received a copy of the GNU General Public License</span>
<a name="c1-20"></a><span class="lineno"> 20</span> <span class="cm">   along with Bash.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="c1-21"></a><span class="lineno"> 21</span> <span class="cm">*/</span>
<a name="c1-22"></a><span class="lineno"> 22</span> 
<a name="c1-23"></a><span class="lineno"> 23</span> <span class="cp">#include "config.h"</span>
<a name="c1-24"></a><span class="lineno"> 24</span> 
<a name="c1-25"></a><span class="lineno"> 25</span> <span class="cp">#include &lt;stdio.h&gt;</span>
<a name="c1-26"></a><span class="lineno"> 26</span> <span class="cp">#include "bashansi.h"</span>
<a name="c1-27"></a><span class="lineno"> 27</span> <span class="cp">#include "chartypes.h"</span>
<a name="c1-28"></a><span class="lineno"> 28</span> <span class="cp">#include &lt;errno.h&gt;</span>
<a name="c1-29"></a><span class="lineno"> 29</span> 
<a name="c1-30"></a><span class="lineno"> 30</span> <span class="cp">#ifdef HAVE_UNISTD_H</span>
<a name="c1-31"></a><span class="lineno"> 31</span> <span class="cp">#  include &lt;unistd.h&gt;</span>
<a name="c1-32"></a><span class="lineno"> 32</span> <span class="cp">#endif</span>
<a name="c1-33"></a><span class="lineno"> 33</span> 
<a name="c1-34"></a><span class="lineno"> 34</span> <span class="cp">#include "syntax.h"</span>
<a name="c1-35"></a><span class="lineno"> 35</span> 
<a name="c1-36"></a><span class="lineno"> 36</span> <span class="k">extern</span> <span class="kt">int</span> <span class="n">optind</span><span class="p">;</span>
<a name="c1-37"></a><span class="lineno"> 37</span> <span class="k">extern</span> <span class="kt">char</span> <span class="o">*</span><span class="n">optarg</span><span class="p">;</span>
<a name="c1-38"></a><span class="lineno"> 38</span> 
<a name="c1-39"></a><span class="lineno"> 39</span> <span class="cp">#ifndef errno</span>
<a name="c1-40"></a><span class="lineno"> 40</span> <span class="k">extern</span> <span class="kt">int</span> <span class="n">errno</span><span class="p">;</span>
<a name="c1-41"></a><span class="lineno"> 41</span> <span class="cp">#endif</span>
<a name="c1-42"></a><span class="lineno"> 42</span> 
<a name="c1-43"></a><span class="lineno"> 43</span> <span class="cp">#ifndef HAVE_STRERROR</span>
<a name="c1-44"></a><span class="lineno"> 44</span> <span class="k">extern</span> <span class="kt">char</span> <span class="o">*</span><span class="n">strerror</span><span class="p">();</span>
<a name="c1-45"></a><span class="lineno"> 45</span> <span class="cp">#endif</span>
<a name="c1-46"></a><span class="lineno"> 46</span> 
<a name="c1-47"></a><span class="lineno"> 47</span> <span class="k">struct</span> <span class="n">wordflag</span> <span class="p">{</span>
<a name="c1-48"></a><span class="lineno"> 48</span>   <span class="kt">int</span> <span class="n">flag</span><span class="p">;</span>
<a name="c1-49"></a><span class="lineno"> 49</span>   <span class="kt">char</span>  <span class="o">*</span><span class="n">fstr</span><span class="p">;</span>
<a name="c1-50"></a><span class="lineno"> 50</span> <span class="p">}</span> <span class="n">wordflags</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<a name="c1-51"></a><span class="lineno"> 51</span>   <span class="p">{</span> <span class="n">CWORD</span><span class="p">,</span> <span class="s">"CWORD"</span> <span class="p">},</span>
<a name="c1-52"></a><span class="lineno"> 52</span>   <span class="p">{</span> <span class="n">CSHMETA</span><span class="p">,</span> <span class="s">"CSHMETA"</span> <span class="p">},</span>
<a name="c1-53"></a><span class="lineno"> 53</span>   <span class="p">{</span> <span class="n">CSHBRK</span><span class="p">,</span>  <span class="s">"CSHBRK"</span> <span class="p">},</span>
<a name="c1-54"></a><span class="lineno"> 54</span>   <span class="p">{</span> <span class="n">CBACKQ</span><span class="p">,</span>  <span class="s">"CBACKQ"</span> <span class="p">},</span>
<a name="c1-55"></a><span class="lineno"> 55</span>   <span class="p">{</span> <span class="n">CQUOTE</span><span class="p">,</span>  <span class="s">"CQUOTE"</span> <span class="p">},</span>
<a name="c1-56"></a><span class="lineno"> 56</span>   <span class="p">{</span> <span class="n">CSPECL</span><span class="p">,</span>  <span class="s">"CSPECL"</span> <span class="p">},</span>
<a name="c1-57"></a><span class="lineno"> 57</span>   <span class="p">{</span> <span class="n">CEXP</span><span class="p">,</span>    <span class="s">"CEXP"</span> <span class="p">},</span>
<a name="c1-58"></a><span class="lineno"> 58</span>   <span class="p">{</span> <span class="n">CBSDQUOTE</span><span class="p">,</span> <span class="s">"CBSDQUOTE"</span> <span class="p">},</span>
<a name="c1-59"></a><span class="lineno"> 59</span>   <span class="p">{</span> <span class="n">CBSHDOC</span><span class="p">,</span> <span class="s">"CBSHDOC"</span> <span class="p">},</span>
<a name="c1-60"></a><span class="lineno"> 60</span>   <span class="p">{</span> <span class="n">CGLOB</span><span class="p">,</span> <span class="s">"CGLOB"</span> <span class="p">},</span>
<a name="c1-61"></a><span class="lineno"> 61</span>   <span class="p">{</span> <span class="n">CXGLOB</span><span class="p">,</span>  <span class="s">"CXGLOB"</span> <span class="p">},</span>
<a name="c1-62"></a><span class="lineno"> 62</span>   <span class="p">{</span> <span class="n">CXQUOTE</span><span class="p">,</span> <span class="s">"CXQUOTE"</span> <span class="p">},</span>
<a name="c1-63"></a><span class="lineno"> 63</span>   <span class="p">{</span> <span class="n">CSPECVAR</span><span class="p">,</span>  <span class="s">"CSPECVAR"</span> <span class="p">},</span>
<a name="c1-64"></a><span class="lineno"> 64</span>   <span class="p">{</span> <span class="n">CSUBSTOP</span><span class="p">,</span>  <span class="s">"CSUBSTOP"</span> <span class="p">},</span>
<a name="c1-65"></a><span class="lineno"> 65</span>   <span class="p">{</span> <span class="n">CBLANK</span><span class="p">,</span>  <span class="s">"CBLANK"</span> <span class="p">},</span>
<a name="c1-66"></a><span class="lineno"> 66</span> <span class="p">};</span>
<a name="c1-67"></a><span class="lineno"> 67</span>   
<a name="c1-68"></a><span class="lineno"> 68</span> <span class="cp">#define N_WFLAGS (sizeof (wordflags) / sizeof (wordflags[0]))</span>
<a name="c1-69"></a><span class="lineno"> 69</span> <span class="cp">#define SYNSIZE    256</span>
<a name="c1-70"></a><span class="lineno"> 70</span> 
<a name="c1-71"></a><span class="lineno"> 71</span> <span class="kt">int</span> <span class="n">lsyntax</span><span class="p">[</span><span class="n">SYNSIZE</span><span class="p">];</span>
<a name="c1-72"></a><span class="lineno"> 72</span> <span class="kt">int</span> <span class="n">debug</span><span class="p">;</span>
<a name="c1-73"></a><span class="lineno"> 73</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">progname</span><span class="p">;</span>
<a name="c1-74"></a><span class="lineno"> 74</span> 
<a name="c1-75"></a><span class="lineno"> 75</span> <span class="kt">char</span>  <span class="n">preamble</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"\</span>
<a name="c1-76"></a><span class="lineno"> 76</span> <span class="s">/*</span><span class="se">\n</span><span class="s">\</span>
<a name="c1-77"></a><span class="lineno"> 77</span> <span class="s"> * This file was generated by mksyntax.  DO NOT EDIT.</span><span class="se">\n</span><span class="s">\</span>
<a name="c1-78"></a><span class="lineno"> 78</span> <span class="s"> */</span><span class="se">\n</span><span class="s">\</span>
<a name="c1-79"></a><span class="lineno"> 79</span> <span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<a name="c1-80"></a><span class="lineno"> 80</span> 
<a name="c1-81"></a><span class="lineno"> 81</span> <span class="kt">char</span>  <span class="n">includes</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"\</span>
<a name="c1-82"></a><span class="lineno"> 82</span> <span class="s">#include </span><span class="se">\"</span><span class="s">config.h</span><span class="se">\"\n</span><span class="s">\</span>
<a name="c1-83"></a><span class="lineno"> 83</span> <span class="s">#include </span><span class="se">\"</span><span class="s">stdc.h</span><span class="se">\"\n</span><span class="s">\</span>
<a name="c1-84"></a><span class="lineno"> 84</span> <span class="s">#include </span><span class="se">\"</span><span class="s">syntax.h</span><span class="se">\"\n\n</span><span class="s">"</span><span class="p">;</span>
<a name="c1-85"></a><span class="lineno"> 85</span> 
<a name="c1-86"></a><span class="lineno"> 86</span> <span class="k">static</span> <span class="kt">void</span>
<a name="c1-87"></a><span class="lineno"> 87</span> <span class="nf">usage</span><span class="p">()</span>
<a name="c1-88"></a><span class="lineno"> 88</span> <span class="p">{</span>
<a name="c1-89"></a><span class="lineno"> 89</span>   <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"%s: usage: %s [-d] [-o filename]</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">progname</span><span class="p">,</span> <span class="n">progname</span><span class="p">);</span>
<a name="c1-90"></a><span class="lineno"> 90</span>   <span class="n">exit</span> <span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a name="c1-91"></a><span class="lineno"> 91</span> <span class="p">}</span>
<a name="c1-92"></a><span class="lineno"> 92</span> 
<a name="c1-93"></a><span class="lineno"> 93</span> <span class="cp">#ifdef INCLUDE_UNUSED</span>
<a name="c1-94"></a><span class="lineno"> 94</span> <span class="k">static</span> <span class="kt">int</span>
<a name="c1-95"></a><span class="lineno"> 95</span> <span class="n">getcflag</span> <span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a name="c1-96"></a><span class="lineno"> 96</span>      <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">;</span>
<a name="c1-97"></a><span class="lineno"> 97</span> <span class="p">{</span>
<a name="c1-98"></a><span class="lineno"> 98</span>   <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<a name="c1-99"></a><span class="lineno"> 99</span> 
<a name="c1-100"></a><span class="lineno">100</span>   <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N_WFLAGS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a name="c1-101"></a><span class="lineno">101</span>     <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">wordflags</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">fstr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="c1-102"></a><span class="lineno">102</span>       <span class="k">return</span> <span class="n">wordflags</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flag</span><span class="p">;</span>
<a name="c1-103"></a><span class="lineno">103</span>   <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<a name="c1-104"></a><span class="lineno">104</span> <span class="p">}</span>
<a name="c1-105"></a><span class="lineno">105</span> <span class="cp">#endif</span>
<a name="c1-106"></a><span class="lineno">106</span> 
<a name="c1-107"></a><span class="lineno">107</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span>
<a name="c1-108"></a><span class="lineno">108</span> <span class="n">cdesc</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="c1-109"></a><span class="lineno">109</span>      <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<a name="c1-110"></a><span class="lineno">110</span> <span class="p">{</span>
<a name="c1-111"></a><span class="lineno">111</span>   <span class="k">static</span> <span class="kt">char</span> <span class="n">xbuf</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<a name="c1-112"></a><span class="lineno">112</span> 
<a name="c1-113"></a><span class="lineno">113</span>   <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="sc">' '</span><span class="p">)</span>
<a name="c1-114"></a><span class="lineno">114</span>     <span class="k">return</span> <span class="s">"SPC"</span><span class="p">;</span>
<a name="c1-115"></a><span class="lineno">115</span>   <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">ISPRINT</span> <span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="c1-116"></a><span class="lineno">116</span>     <span class="p">{</span>
<a name="c1-117"></a><span class="lineno">117</span>       <span class="n">xbuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
<a name="c1-118"></a><span class="lineno">118</span>       <span class="n">xbuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
<a name="c1-119"></a><span class="lineno">119</span>       <span class="k">return</span> <span class="p">(</span><span class="n">xbuf</span><span class="p">);</span>
<a name="c1-120"></a><span class="lineno">120</span>     <span class="p">}</span>
<a name="c1-121"></a><span class="lineno">121</span>   <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">CTLESC</span><span class="p">)</span>
<a name="c1-122"></a><span class="lineno">122</span>     <span class="k">return</span> <span class="s">"CTLESC"</span><span class="p">;</span>
<a name="c1-123"></a><span class="lineno">123</span>   <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">CTLNUL</span><span class="p">)</span>
<a name="c1-124"></a><span class="lineno">124</span>     <span class="k">return</span> <span class="s">"CTLNUL"</span><span class="p">;</span>
<a name="c1-125"></a><span class="lineno">125</span>   <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="sc">'\033'</span><span class="p">)</span>    <span class="cm">/* ASCII */</span>
<a name="c1-126"></a><span class="lineno">126</span>     <span class="k">return</span> <span class="s">"ESC"</span><span class="p">;</span>
<a name="c1-127"></a><span class="lineno">127</span> 
<a name="c1-128"></a><span class="lineno">128</span>   <span class="n">xbuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\\'</span><span class="p">;</span>
<a name="c1-129"></a><span class="lineno">129</span>   <span class="n">xbuf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
<a name="c1-130"></a><span class="lineno">130</span>     
<a name="c1-131"></a><span class="lineno">131</span>   <span class="k">switch</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="c1-132"></a><span class="lineno">132</span>     <span class="p">{</span>
<a name="c1-133"></a><span class="lineno">133</span> <span class="cp">#ifdef __STDC__</span>
<a name="c1-134"></a><span class="lineno">134</span>     <span class="k">case</span> <span class="sc">'\a'</span>: <span class="n">xbuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'a'</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
<a name="c1-135"></a><span class="lineno">135</span>     <span class="k">case</span> <span class="sc">'\v'</span>: <span class="n">xbuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'v'</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
<a name="c1-136"></a><span class="lineno">136</span> <span class="cp">#else</span>
<a name="c1-137"></a><span class="lineno">137</span>     <span class="k">case</span> <span class="sc">'\007'</span>: <span class="n">xbuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'a'</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
<a name="c1-138"></a><span class="lineno">138</span>     <span class="k">case</span> <span class="mh">0x0B</span>: <span class="n">xbuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'v'</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
<a name="c1-139"></a><span class="lineno">139</span> <span class="cp">#endif</span>
<a name="c1-140"></a><span class="lineno">140</span>     <span class="k">case</span> <span class="sc">'\b'</span>: <span class="n">xbuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'b'</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
<a name="c1-141"></a><span class="lineno">141</span>     <span class="k">case</span> <span class="sc">'\f'</span>: <span class="n">xbuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'f'</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
<a name="c1-142"></a><span class="lineno">142</span>     <span class="k">case</span> <span class="sc">'\n'</span>: <span class="n">xbuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'n'</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
<a name="c1-143"></a><span class="lineno">143</span>     <span class="k">case</span> <span class="sc">'\r'</span>: <span class="n">xbuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'r'</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
<a name="c1-144"></a><span class="lineno">144</span>     <span class="k">case</span> <span class="sc">'\t'</span>: <span class="n">xbuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'t'</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
<a name="c1-145"></a><span class="lineno">145</span>     <span class="nl">default:</span> <span class="n">sprintf</span> <span class="p">(</span><span class="n">xbuf</span><span class="p">,</span> <span class="s">"%d"</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
<a name="c1-146"></a><span class="lineno">146</span>     <span class="p">}</span>
<a name="c1-147"></a><span class="lineno">147</span> 
<a name="c1-148"></a><span class="lineno">148</span>   <span class="k">return</span> <span class="n">xbuf</span><span class="p">;</span>  
<a name="c1-149"></a><span class="lineno">149</span> <span class="p">}</span>
<a name="c1-150"></a><span class="lineno">150</span> 
<a name="c1-151"></a><span class="lineno">151</span> <span class="k">static</span> <span class="kt">char</span> <span class="o">*</span>
<a name="c1-152"></a><span class="lineno">152</span> <span class="n">getcstr</span> <span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a name="c1-153"></a><span class="lineno">153</span>      <span class="kt">int</span> <span class="n">f</span><span class="p">;</span>
<a name="c1-154"></a><span class="lineno">154</span> <span class="p">{</span>
<a name="c1-155"></a><span class="lineno">155</span>   <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<a name="c1-156"></a><span class="lineno">156</span> 
<a name="c1-157"></a><span class="lineno">157</span>   <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N_WFLAGS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a name="c1-158"></a><span class="lineno">158</span>     <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">==</span> <span class="n">wordflags</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flag</span><span class="p">)</span>
<a name="c1-159"></a><span class="lineno">159</span>       <span class="k">return</span> <span class="p">(</span><span class="n">wordflags</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">fstr</span><span class="p">);</span>
<a name="c1-160"></a><span class="lineno">160</span>   <span class="k">return</span> <span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">);</span>
<a name="c1-161"></a><span class="lineno">161</span> <span class="p">}</span>
<a name="c1-162"></a><span class="lineno">162</span> 
<a name="c1-163"></a><span class="lineno">163</span> <span class="k">static</span> <span class="kt">void</span>
<a name="c1-164"></a><span class="lineno">164</span> <span class="n">addcstr</span> <span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span>
<a name="c1-165"></a><span class="lineno">165</span>      <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">;</span>
<a name="c1-166"></a><span class="lineno">166</span>      <span class="kt">int</span> <span class="n">flag</span><span class="p">;</span>
<a name="c1-167"></a><span class="lineno">167</span> <span class="p">{</span>
<a name="c1-168"></a><span class="lineno">168</span>   <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="o">*</span><span class="n">fstr</span><span class="p">;</span>
<a name="c1-169"></a><span class="lineno">169</span>   <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">uc</span><span class="p">;</span>
<a name="c1-170"></a><span class="lineno">170</span> 
<a name="c1-171"></a><span class="lineno">171</span>   <span class="k">for</span> <span class="p">(</span><span class="n">s</span> <span class="o">=</span> <span class="n">str</span><span class="p">;</span> <span class="n">s</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">s</span><span class="p">;</span> <span class="n">s</span><span class="o">++</span><span class="p">)</span>
<a name="c1-172"></a><span class="lineno">172</span>     <span class="p">{</span>
<a name="c1-173"></a><span class="lineno">173</span>       <span class="n">uc</span> <span class="o">=</span> <span class="o">*</span><span class="n">s</span><span class="p">;</span>
<a name="c1-174"></a><span class="lineno">174</span> 
<a name="c1-175"></a><span class="lineno">175</span>       <span class="k">if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span>
<a name="c1-176"></a><span class="lineno">176</span>  <span class="p">{</span>
<a name="c1-177"></a><span class="lineno">177</span>    <span class="n">fstr</span> <span class="o">=</span> <span class="n">getcstr</span> <span class="p">(</span><span class="n">flag</span><span class="p">);</span>
<a name="c1-178"></a><span class="lineno">178</span>    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"added %s for character %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">fstr</span><span class="p">,</span> <span class="n">cdesc</span><span class="p">(</span><span class="n">uc</span><span class="p">));</span>
<a name="c1-179"></a><span class="lineno">179</span>  <span class="p">}</span>
<a name="c1-180"></a><span class="lineno">180</span>  
<a name="c1-181"></a><span class="lineno">181</span>       <span class="n">lsyntax</span><span class="p">[</span><span class="n">uc</span><span class="p">]</span> <span class="o">|=</span> <span class="n">flag</span><span class="p">;</span>
<a name="c1-182"></a><span class="lineno">182</span>     <span class="p">}</span>
<a name="c1-183"></a><span class="lineno">183</span> <span class="p">}</span>
<a name="c1-184"></a><span class="lineno">184</span> 
<a name="c1-185"></a><span class="lineno">185</span> <span class="k">static</span> <span class="kt">void</span>
<a name="c1-186"></a><span class="lineno">186</span> <span class="n">addcchar</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span>
<a name="c1-187"></a><span class="lineno">187</span>      <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
<a name="c1-188"></a><span class="lineno">188</span>      <span class="kt">int</span> <span class="n">flag</span><span class="p">;</span>
<a name="c1-189"></a><span class="lineno">189</span> <span class="p">{</span>
<a name="c1-190"></a><span class="lineno">190</span>   <span class="kt">char</span> <span class="o">*</span><span class="n">fstr</span><span class="p">;</span>
<a name="c1-191"></a><span class="lineno">191</span> 
<a name="c1-192"></a><span class="lineno">192</span>   <span class="k">if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span>
<a name="c1-193"></a><span class="lineno">193</span>     <span class="p">{</span>
<a name="c1-194"></a><span class="lineno">194</span>       <span class="n">fstr</span> <span class="o">=</span> <span class="n">getcstr</span> <span class="p">(</span><span class="n">flag</span><span class="p">);</span>
<a name="c1-195"></a><span class="lineno">195</span>       <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"added %s for character %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">fstr</span><span class="p">,</span> <span class="n">cdesc</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
<a name="c1-196"></a><span class="lineno">196</span>     <span class="p">}</span>
<a name="c1-197"></a><span class="lineno">197</span>   <span class="n">lsyntax</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">|=</span> <span class="n">flag</span><span class="p">;</span>
<a name="c1-198"></a><span class="lineno">198</span> <span class="p">}</span>
<a name="c1-199"></a><span class="lineno">199</span> 
<a name="c1-200"></a><span class="lineno">200</span> <span class="k">static</span> <span class="kt">void</span>
<a name="c1-201"></a><span class="lineno">201</span> <span class="n">addblanks</span> <span class="p">()</span>
<a name="c1-202"></a><span class="lineno">202</span> <span class="p">{</span>
<a name="c1-203"></a><span class="lineno">203</span>   <span class="k">register</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<a name="c1-204"></a><span class="lineno">204</span>   <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">uc</span><span class="p">;</span>
<a name="c1-205"></a><span class="lineno">205</span> 
<a name="c1-206"></a><span class="lineno">206</span>   <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SYNSIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a name="c1-207"></a><span class="lineno">207</span>     <span class="p">{</span>
<a name="c1-208"></a><span class="lineno">208</span>       <span class="n">uc</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
<a name="c1-209"></a><span class="lineno">209</span>       <span class="cm">/* Since we don't call setlocale(), this defaults to the "C" locale, and</span>
<a name="c1-210"></a><span class="lineno">210</span> <span class="cm">   the default blank characters will be space and tab. */</span>
<a name="c1-211"></a><span class="lineno">211</span>       <span class="k">if</span> <span class="p">(</span><span class="n">isblank</span> <span class="p">(</span><span class="n">uc</span><span class="p">))</span>
<a name="c1-212"></a><span class="lineno">212</span>  <span class="n">lsyntax</span><span class="p">[</span><span class="n">uc</span><span class="p">]</span> <span class="o">|=</span> <span class="n">CBLANK</span><span class="p">;</span>
<a name="c1-213"></a><span class="lineno">213</span>     <span class="p">}</span>
<a name="c1-214"></a><span class="lineno">214</span> <span class="p">}</span>
<a name="c1-215"></a><span class="lineno">215</span> 
<a name="c1-216"></a><span class="lineno">216</span> <span class="cm">/* load up the correct flag values in lsyntax */</span>
<a name="c1-217"></a><span class="lineno">217</span> <span class="k">static</span> <span class="kt">void</span>
<a name="c1-218"></a><span class="lineno">218</span> <span class="n">load_lsyntax</span> <span class="p">()</span>
<a name="c1-219"></a><span class="lineno">219</span> <span class="hll"><span class="p">{</span>
</span><a name="c1-220"></a><span class="lineno">220</span> <span class="hll">  <span class="cm">/* shell metacharacters */</span>
</span><a name="c1-221"></a><span class="lineno">221</span> <span class="hll">  <span class="n">addcstr</span> <span class="p">(</span><span class="n">shell_meta_chars</span><span class="p">,</span> <span class="n">CSHMETA</span><span class="p">);</span>
</span><a name="c1-222"></a><span class="lineno">222</span> <span class="hll">
</span><a name="c1-223"></a><span class="lineno">223</span> <span class="hll">  <span class="cm">/* shell word break characters */</span>
</span><a name="c1-224"></a><span class="lineno">224</span> <span class="hll">  <span class="n">addcstr</span> <span class="p">(</span><span class="n">shell_break_chars</span><span class="p">,</span> <span class="n">CSHBRK</span><span class="p">);</span>
</span><a name="c1-225"></a><span class="lineno">225</span> <span class="hll">
</span><a name="c1-226"></a><span class="lineno">226</span> <span class="hll">  <span class="n">addcchar</span> <span class="p">(</span><span class="sc">'`'</span><span class="p">,</span> <span class="n">CBACKQ</span><span class="p">);</span>
</span><a name="c1-227"></a><span class="lineno">227</span> <span class="hll">
</span><a name="c1-228"></a><span class="lineno">228</span> <span class="hll">  <span class="n">addcstr</span> <span class="p">(</span><span class="n">shell_quote_chars</span><span class="p">,</span> <span class="n">CQUOTE</span><span class="p">);</span>
</span><a name="c1-229"></a><span class="lineno">229</span> <span class="hll">
</span><a name="c1-230"></a><span class="lineno">230</span> <span class="hll">  <span class="n">addcchar</span> <span class="p">(</span><span class="n">CTLESC</span><span class="p">,</span> <span class="n">CSPECL</span><span class="p">);</span>
</span><a name="c1-231"></a><span class="lineno">231</span> <span class="hll">  <span class="n">addcchar</span> <span class="p">(</span><span class="n">CTLNUL</span><span class="p">,</span> <span class="n">CSPECL</span><span class="p">);</span>
</span><a name="c1-232"></a><span class="lineno">232</span> <span class="hll">
</span><a name="c1-233"></a><span class="lineno">233</span> <span class="hll">  <span class="n">addcstr</span> <span class="p">(</span><span class="n">shell_exp_chars</span><span class="p">,</span> <span class="n">CEXP</span><span class="p">);</span>
</span><a name="c1-234"></a><span class="lineno">234</span> <span class="hll">
</span><a name="c1-235"></a><span class="lineno">235</span>   <span class="n">addcstr</span> <span class="p">(</span><span class="n">slashify_in_quotes</span><span class="p">,</span> <span class="n">CBSDQUOTE</span><span class="p">);</span>
<a name="c1-236"></a><span class="lineno">236</span>   <span class="n">addcstr</span> <span class="p">(</span><span class="n">slashify_in_here_document</span><span class="p">,</span> <span class="n">CBSHDOC</span><span class="p">);</span>
<a name="c1-237"></a><span class="lineno">237</span> 
<a name="c1-238"></a><span class="lineno">238</span>   <span class="n">addcstr</span> <span class="p">(</span><span class="n">shell_glob_chars</span><span class="p">,</span> <span class="n">CGLOB</span><span class="p">);</span>
<a name="c1-239"></a><span class="lineno">239</span> 
<a name="c1-240"></a><span class="lineno">240</span> <span class="cp">#if defined (EXTENDED_GLOB)</span>
<a name="c1-241"></a><span class="lineno">241</span>   <span class="n">addcstr</span> <span class="p">(</span><span class="n">ext_glob_chars</span><span class="p">,</span> <span class="n">CXGLOB</span><span class="p">);</span>
<a name="c1-242"></a><span class="lineno">242</span> <span class="cp">#endif</span>
<a name="c1-243"></a><span class="lineno">243</span> 
<a name="c1-244"></a><span class="lineno">244</span>   <span class="n">addcstr</span> <span class="p">(</span><span class="n">shell_quote_chars</span><span class="p">,</span> <span class="n">CXQUOTE</span><span class="p">);</span>
<a name="c1-245"></a><span class="lineno">245</span>   <span class="n">addcchar</span> <span class="p">(</span><span class="sc">'\\'</span><span class="p">,</span> <span class="n">CXQUOTE</span><span class="p">);</span>
<a name="c1-246"></a><span class="lineno">246</span> 
<a name="c1-247"></a><span class="lineno">247</span>   <span class="n">addcstr</span> <span class="p">(</span><span class="s">"@*#?-$!"</span><span class="p">,</span> <span class="n">CSPECVAR</span><span class="p">);</span> <span class="cm">/* omits $0...$9 and $_ */</span>
<a name="c1-248"></a><span class="lineno">248</span> 
<a name="c1-249"></a><span class="lineno">249</span>   <span class="n">addcstr</span> <span class="p">(</span><span class="s">"-=?+"</span><span class="p">,</span> <span class="n">CSUBSTOP</span><span class="p">);</span>    <span class="cm">/* OP in ${paramOPword} */</span>
<a name="c1-250"></a><span class="lineno">250</span> 
<a name="c1-251"></a><span class="lineno">251</span>   <span class="n">addblanks</span> <span class="p">();</span>
<a name="c1-252"></a><span class="lineno">252</span> <span class="p">}</span>
<a name="c1-253"></a><span class="lineno">253</span> 
<a name="c1-254"></a><span class="lineno">254</span> <span class="k">static</span> <span class="kt">void</span>
<a name="c1-255"></a><span class="lineno">255</span> <span class="n">dump_lflags</span> <span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">ind</span><span class="p">)</span>
<a name="c1-256"></a><span class="lineno">256</span>      <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">;</span>
<a name="c1-257"></a><span class="lineno">257</span>      <span class="kt">int</span> <span class="n">ind</span><span class="p">;</span>
<a name="c1-258"></a><span class="lineno">258</span> <span class="p">{</span>
<a name="c1-259"></a><span class="lineno">259</span>   <span class="kt">int</span> <span class="n">xflags</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
<a name="c1-260"></a><span class="lineno">260</span> 
<a name="c1-261"></a><span class="lineno">261</span>   <span class="n">xflags</span> <span class="o">=</span> <span class="n">lsyntax</span><span class="p">[</span><span class="n">ind</span><span class="p">];</span>
<a name="c1-262"></a><span class="lineno">262</span>   <span class="n">first</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="c1-263"></a><span class="lineno">263</span> 
<a name="c1-264"></a><span class="lineno">264</span>   <span class="k">if</span> <span class="p">(</span><span class="n">xflags</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="c1-265"></a><span class="lineno">265</span>     <span class="n">fputs</span> <span class="p">(</span><span class="n">wordflags</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fstr</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
<a name="c1-266"></a><span class="lineno">266</span>   <span class="k">else</span>
<a name="c1-267"></a><span class="lineno">267</span>     <span class="p">{</span>
<a name="c1-268"></a><span class="lineno">268</span>       <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N_WFLAGS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a name="c1-269"></a><span class="lineno">269</span>  <span class="k">if</span> <span class="p">(</span><span class="n">xflags</span> <span class="o">&amp;</span> <span class="n">wordflags</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flag</span><span class="p">)</span>
<a name="c1-270"></a><span class="lineno">270</span>    <span class="p">{</span>
<a name="c1-271"></a><span class="lineno">271</span>      <span class="k">if</span> <span class="p">(</span><span class="n">first</span><span class="p">)</span>
<a name="c1-272"></a><span class="lineno">272</span>        <span class="n">first</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="c1-273"></a><span class="lineno">273</span>      <span class="k">else</span>
<a name="c1-274"></a><span class="lineno">274</span>        <span class="n">putc</span> <span class="p">(</span><span class="sc">'|'</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
<a name="c1-275"></a><span class="lineno">275</span>      <span class="n">fputs</span> <span class="p">(</span><span class="n">wordflags</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">fstr</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
<a name="c1-276"></a><span class="lineno">276</span>      <span class="p">}</span>
<a name="c1-277"></a><span class="lineno">277</span>     <span class="p">}</span>
<a name="c1-278"></a><span class="lineno">278</span> <span class="p">}</span>
<a name="c1-279"></a><span class="lineno">279</span> 
<a name="c1-280"></a><span class="lineno">280</span> <span class="k">static</span> <span class="kt">void</span>
<a name="c1-281"></a><span class="lineno">281</span> <span class="n">wcomment</span> <span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a name="c1-282"></a><span class="lineno">282</span>      <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">;</span>
<a name="c1-283"></a><span class="lineno">283</span>      <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<a name="c1-284"></a><span class="lineno">284</span> <span class="p">{</span>
<a name="c1-285"></a><span class="lineno">285</span>   <span class="n">fputs</span> <span class="p">(</span><span class="s">"</span><span class="se">\t\t</span><span class="s">/* "</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
<a name="c1-286"></a><span class="lineno">286</span> 
<a name="c1-287"></a><span class="lineno">287</span>   <span class="n">fprintf</span> <span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">"%s"</span><span class="p">,</span> <span class="n">cdesc</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
<a name="c1-288"></a><span class="lineno">288</span>       
<a name="c1-289"></a><span class="lineno">289</span>   <span class="n">fputs</span> <span class="p">(</span><span class="s">" */"</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
<a name="c1-290"></a><span class="lineno">290</span> <span class="p">}</span>
<a name="c1-291"></a><span class="lineno">291</span> 
<a name="c1-292"></a><span class="lineno">292</span> <span class="k">static</span> <span class="kt">void</span>
<a name="c1-293"></a><span class="lineno">293</span> <span class="n">dump_lsyntax</span> <span class="p">(</span><span class="n">fp</span><span class="p">)</span>
<a name="c1-294"></a><span class="lineno">294</span>      <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">;</span>
<a name="c1-295"></a><span class="lineno">295</span> <span class="p">{</span>
<a name="c1-296"></a><span class="lineno">296</span>   <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<a name="c1-297"></a><span class="lineno">297</span> 
<a name="c1-298"></a><span class="lineno">298</span>   <span class="n">fprintf</span> <span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">"int sh_syntabsiz = %d;</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">SYNSIZE</span><span class="p">);</span>
<a name="c1-299"></a><span class="lineno">299</span>   <span class="n">fprintf</span> <span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">"int sh_syntaxtab[%d] = {</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">SYNSIZE</span><span class="p">);</span>
<a name="c1-300"></a><span class="lineno">300</span> 
<a name="c1-301"></a><span class="lineno">301</span>   <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SYNSIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a name="c1-302"></a><span class="lineno">302</span>     <span class="p">{</span>
<a name="c1-303"></a><span class="lineno">303</span>       <span class="n">putc</span> <span class="p">(</span><span class="sc">'\t'</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
<a name="c1-304"></a><span class="lineno">304</span>       <span class="n">dump_lflags</span> <span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
<a name="c1-305"></a><span class="lineno">305</span>       <span class="n">putc</span> <span class="p">(</span><span class="sc">','</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
<a name="c1-306"></a><span class="lineno">306</span>       <span class="n">wcomment</span> <span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
<a name="c1-307"></a><span class="lineno">307</span>       <span class="n">putc</span> <span class="p">(</span><span class="sc">'\n'</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
<a name="c1-308"></a><span class="lineno">308</span>     <span class="p">}</span>
<a name="c1-309"></a><span class="lineno">309</span> 
<a name="c1-310"></a><span class="lineno">310</span>   <span class="n">fprintf</span> <span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">"};</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<a name="c1-311"></a><span class="lineno">311</span> <span class="p">}</span>
<a name="c1-312"></a><span class="lineno">312</span> 
<a name="c1-313"></a><span class="lineno">313</span> <span class="kt">int</span>
<a name="c1-314"></a><span class="lineno">314</span> <span class="n">main</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">)</span>
<a name="c1-315"></a><span class="lineno">315</span>      <span class="kt">int</span> <span class="n">argc</span><span class="p">;</span>
<a name="c1-316"></a><span class="lineno">316</span>      <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">;</span>
<a name="c1-317"></a><span class="lineno">317</span> <span class="p">{</span>
<a name="c1-318"></a><span class="lineno">318</span>   <span class="kt">int</span> <span class="n">opt</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
<a name="c1-319"></a><span class="lineno">319</span>   <span class="kt">char</span> <span class="o">*</span><span class="n">filename</span><span class="p">;</span>
<a name="c1-320"></a><span class="lineno">320</span>   <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">;</span>
<a name="c1-321"></a><span class="lineno">321</span> 
<a name="c1-322"></a><span class="lineno">322</span>   <span class="k">if</span> <span class="p">((</span><span class="n">progname</span> <span class="o">=</span> <span class="n">strrchr</span> <span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="sc">'/'</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="c1-323"></a><span class="lineno">323</span>     <span class="n">progname</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a name="c1-324"></a><span class="lineno">324</span>   <span class="k">else</span>
<a name="c1-325"></a><span class="lineno">325</span>     <span class="n">progname</span><span class="o">++</span><span class="p">;</span>
<a name="c1-326"></a><span class="lineno">326</span> 
<a name="c1-327"></a><span class="lineno">327</span>   <span class="n">filename</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">;</span>
<a name="c1-328"></a><span class="lineno">328</span>   <span class="n">debug</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a name="c1-329"></a><span class="lineno">329</span> 
<a name="c1-330"></a><span class="lineno">330</span>   <span class="k">while</span> <span class="p">((</span><span class="n">opt</span> <span class="o">=</span> <span class="n">getopt</span> <span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="s">"do:"</span><span class="p">))</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">)</span>
<a name="c1-331"></a><span class="lineno">331</span>     <span class="p">{</span>
<a name="c1-332"></a><span class="lineno">332</span>       <span class="k">switch</span> <span class="p">(</span><span class="n">opt</span><span class="p">)</span>
<a name="c1-333"></a><span class="lineno">333</span>  <span class="p">{</span>
<a name="c1-334"></a><span class="lineno">334</span>  <span class="k">case</span> <span class="sc">'d'</span>:
<a name="c1-335"></a><span class="lineno">335</span>    <span class="n">debug</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a name="c1-336"></a><span class="lineno">336</span>    <span class="k">break</span><span class="p">;</span>
<a name="c1-337"></a><span class="lineno">337</span>  <span class="k">case</span> <span class="sc">'o'</span>:
<a name="c1-338"></a><span class="lineno">338</span>    <span class="n">filename</span> <span class="o">=</span> <span class="n">optarg</span><span class="p">;</span>
<a name="c1-339"></a><span class="lineno">339</span>    <span class="k">break</span><span class="p">;</span>
<a name="c1-340"></a><span class="lineno">340</span>  <span class="nl">default:</span>
<a name="c1-341"></a><span class="lineno">341</span>    <span class="n">usage</span><span class="p">();</span>
<a name="c1-342"></a><span class="lineno">342</span>  <span class="p">}</span>
<a name="c1-343"></a><span class="lineno">343</span>     <span class="p">}</span>
<a name="c1-344"></a><span class="lineno">344</span> 
<a name="c1-345"></a><span class="lineno">345</span>   <span class="n">argc</span> <span class="o">-=</span> <span class="n">optind</span><span class="p">;</span>
<a name="c1-346"></a><span class="lineno">346</span>   <span class="n">argv</span> <span class="o">+=</span> <span class="n">optind</span><span class="p">;</span>
<a name="c1-347"></a><span class="lineno">347</span> 
<a name="c1-348"></a><span class="lineno">348</span>   <span class="k">if</span> <span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a name="c1-349"></a><span class="lineno">349</span>     <span class="p">{</span>
<a name="c1-350"></a><span class="lineno">350</span>       <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">"w"</span><span class="p">);</span>
<a name="c1-351"></a><span class="lineno">351</span>       <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="c1-352"></a><span class="lineno">352</span>  <span class="p">{</span>
<a name="c1-353"></a><span class="lineno">353</span>    <span class="n">fprintf</span> <span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s">"%s: %s: cannot open: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">progname</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="n">errno</span><span class="p">));</span>
<a name="c1-354"></a><span class="lineno">354</span>    <span class="n">exit</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a name="c1-355"></a><span class="lineno">355</span>  <span class="p">}</span>
<a name="c1-356"></a><span class="lineno">356</span>     <span class="p">}</span>
<a name="c1-357"></a><span class="lineno">357</span>   <span class="k">else</span>
<a name="c1-358"></a><span class="lineno">358</span>     <span class="p">{</span>
<a name="c1-359"></a><span class="lineno">359</span>       <span class="n">filename</span> <span class="o">=</span> <span class="s">"stdout"</span><span class="p">;</span>
<a name="c1-360"></a><span class="lineno">360</span>       <span class="n">fp</span> <span class="o">=</span> <span class="n">stdout</span><span class="p">;</span>
<a name="c1-361"></a><span class="lineno">361</span>     <span class="p">}</span>
<a name="c1-362"></a><span class="lineno">362</span> 
<a name="c1-363"></a><span class="lineno">363</span> 
<a name="c1-364"></a><span class="lineno">364</span>   <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SYNSIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<a name="c1-365"></a><span class="lineno">365</span>     <span class="n">lsyntax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">CWORD</span><span class="p">;</span>
<a name="c1-366"></a><span class="lineno">366</span> 
<a name="c1-367"></a><span class="lineno">367</span>   <span class="n">load_lsyntax</span> <span class="p">();</span>
<a name="c1-368"></a><span class="lineno">368</span> 
<a name="c1-369"></a><span class="lineno">369</span>   <span class="n">fprintf</span> <span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">preamble</span><span class="p">);</span>
<a name="c1-370"></a><span class="lineno">370</span>   <span class="n">fprintf</span> <span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">includes</span><span class="p">);</span>
<a name="c1-371"></a><span class="lineno">371</span> 
<a name="c1-372"></a><span class="lineno">372</span>   <span class="n">dump_lsyntax</span> <span class="p">(</span><span class="n">fp</span><span class="p">);</span>
<a name="c1-373"></a><span class="lineno">373</span> 
<a name="c1-374"></a><span class="lineno">374</span>   <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">!=</span> <span class="n">stdout</span><span class="p">)</span>
<a name="c1-375"></a><span class="lineno">375</span>     <span class="n">fclose</span> <span class="p">(</span><span class="n">fp</span><span class="p">);</span>
<a name="c1-376"></a><span class="lineno">376</span>   <span class="n">exit</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a name="c1-377"></a><span class="lineno">377</span> <span class="p">}</span>
<a name="c1-378"></a><span class="lineno">378</span> 
<a name="c1-379"></a><span class="lineno">379</span> 
<a name="c1-380"></a><span class="lineno">380</span> <span class="cp">#if !defined (HAVE_STRERROR)</span>
<a name="c1-381"></a><span class="lineno">381</span> 
<a name="c1-382"></a><span class="lineno">382</span> <span class="cp">#include &lt;bashtypes.h&gt;</span>
<a name="c1-383"></a><span class="lineno">383</span> <span class="cp">#ifndef _MINIX</span>
<a name="c1-384"></a><span class="lineno">384</span> <span class="cp">#  include &lt;sys/param.h&gt;</span>
<a name="c1-385"></a><span class="lineno">385</span> <span class="cp">#endif</span>
<a name="c1-386"></a><span class="lineno">386</span> 
<a name="c1-387"></a><span class="lineno">387</span> <span class="cp">#if defined (HAVE_UNISTD_H)</span>
<a name="c1-388"></a><span class="lineno">388</span> <span class="cp">#  include &lt;unistd.h&gt;</span>
<a name="c1-389"></a><span class="lineno">389</span> <span class="cp">#endif</span>
<a name="c1-390"></a><span class="lineno">390</span> 
<a name="c1-391"></a><span class="lineno">391</span> <span class="cm">/* Return a string corresponding to the error number E.  From</span>
<a name="c1-392"></a><span class="lineno">392</span> <span class="cm">   the ANSI C spec. */</span>
<a name="c1-393"></a><span class="lineno">393</span> <span class="cp">#if defined (strerror)</span>
<a name="c1-394"></a><span class="lineno">394</span> <span class="cp">#  undef strerror</span>
<a name="c1-395"></a><span class="lineno">395</span> <span class="cp">#endif</span>
<a name="c1-396"></a><span class="lineno">396</span> 
<a name="c1-397"></a><span class="lineno">397</span> <span class="kt">char</span> <span class="o">*</span>
<a name="c1-398"></a><span class="lineno">398</span> <span class="n">strerror</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a name="c1-399"></a><span class="lineno">399</span>      <span class="kt">int</span> <span class="n">e</span><span class="p">;</span>
<a name="c1-400"></a><span class="lineno">400</span> <span class="p">{</span>
<a name="c1-401"></a><span class="lineno">401</span>   <span class="k">static</span> <span class="kt">char</span> <span class="n">emsg</span><span class="p">[</span><span class="mi">40</span><span class="p">];</span>
<a name="c1-402"></a><span class="lineno">402</span> <span class="cp">#if defined (HAVE_SYS_ERRLIST)</span>
<a name="c1-403"></a><span class="lineno">403</span>   <span class="k">extern</span> <span class="kt">int</span> <span class="n">sys_nerr</span><span class="p">;</span>
<a name="c1-404"></a><span class="lineno">404</span>   <span class="k">extern</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sys_errlist</span><span class="p">[];</span>
<a name="c1-405"></a><span class="lineno">405</span> 
<a name="c1-406"></a><span class="lineno">406</span>   <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="n">sys_nerr</span><span class="p">)</span>
<a name="c1-407"></a><span class="lineno">407</span>     <span class="k">return</span> <span class="p">(</span><span class="n">sys_errlist</span><span class="p">[</span><span class="n">e</span><span class="p">]);</span>
<a name="c1-408"></a><span class="lineno">408</span>   <span class="k">else</span>
<a name="c1-409"></a><span class="lineno">409</span> <span class="cp">#endif </span><span class="cm">/* HAVE_SYS_ERRLIST */</span><span class="cp"></span>
<a name="c1-410"></a><span class="lineno">410</span>     <span class="p">{</span>
<a name="c1-411"></a><span class="lineno">411</span>       <span class="n">sprintf</span> <span class="p">(</span><span class="n">emsg</span><span class="p">,</span> <span class="s">"Unknown system error %d"</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
<a name="c1-412"></a><span class="lineno">412</span>       <span class="k">return</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">emsg</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<a name="c1-413"></a><span class="lineno">413</span>     <span class="p">}</span>
<a name="c1-414"></a><span class="lineno">414</span> <span class="p">}</span>
<a name="c1-415"></a><span class="lineno">415</span> <span class="cp">#endif </span><span class="cm">/* HAVE_STRERROR */</span><span class="cp"></span>
</pre></div>

                </div>
                <div class="scrollable-sections-bottom-shadow" style="opacity: 5.5;"></div>
            </div>
        </div>
        
    </div>
    
</body></html>